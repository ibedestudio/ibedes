---
import Layout from "../layouts/Layout.astro";
import Section from "../components/common/Section.astro";
import AffiliateProducts from "../components/AffiliateProducts.astro";
import { GLOBAL } from "../lib/variables";
import { loadAffiliateProducts } from "../lib/affiliates";

const products = await loadAffiliateProducts();
const verifiedProducts = products.filter((product) => product.verified);
const categories = Array.from(new Set(products.map((product) => product.category))).filter(Boolean);

const categoryProducts = categories.map((category) => ({
  name: category,
  items: products.filter((product) => product.category === category),
}));

const highlights = [
  {
    title: "Sudah dicoba sendiri",
    description: "Produk yang aku pakai untuk kerja sehari-hari, produksi konten, atau bepergian.",
    icon: "fa-solid fa-circle-check",
  },
  {
    title: "Link resmi dan aman",
    description: "Semua link menuju toko resmi/terpercaya dengan penanda platform yang jelas.",
    icon: "fa-solid fa-shield-heart",
  },
  {
    title: "Harga & diskon terpantau",
    description: "Tampilkan harga terkini, diskon, dan rating biar kamu bisa bandingkan cepat.",
    icon: "fa-solid fa-tags",
  },
];

const slugify = (value: string) =>
  value
    .toLowerCase()
    .replace(/[^a-z0-9\s-]/g, "")
    .trim()
    .replace(/\s+/g, "-");
---

<Layout
  title={`Produk Affiliate â€¢ ${GLOBAL.username}`}
  description="Katalog gear yang aku pakai sendiri: perlengkapan konten, gadget, dan alat pendukung produktivitas. Semua link aman dan sudah kurasi."
  image={`${GLOBAL.rootUrl}/${GLOBAL.profileImage}`}
  breadcrumbs={[
    { name: "Home", url: "/" },
    { name: "Produk Affiliate", url: "/affiliate" },
  ]}
  keywords="affiliate, rekomendasi produk, konten kreator, gadget, perlengkapan kerja"
>
  <Section class="py-16 space-y-6">
    <p class="font-display text-xs uppercase tracking-[0.35em] zag-muted">
      Affiliate Store
    </p>
    <h1 class="text-3xl sm:text-4xl font-display leading-tight">
      Gear pilihan yang sering kupakai, lengkap dengan link resmi.
    </h1>
    <p class="text-base sm:text-lg max-w-3xl">
      Kumpulan produk yang kupakai untuk mendukung kerja remote, produksi konten, dan aktivitas harian.
      Setiap pembelian lewat link di bawah membantu mendukung konten tanpa biaya tambahan.
    </p>
    <div class="flex flex-wrap gap-3 text-xs uppercase tracking-[0.25em]">
      <span class="px-4 py-2 border border-black/30 dark:border-white/40 rounded-full">
        Update berkala
      </span>
      <span class="px-4 py-2 border border-black/30 dark:border-white/40 rounded-full">
        Disclosure: ada tautan affiliate
      </span>
      <span class="px-4 py-2 border border-black/30 dark:border-white/40 rounded-full">
        Verified = sudah dicoba
      </span>
    </div>
  </Section>

  <Section class="py-10 space-y-6">
    <div class="grid gap-4 md:grid-cols-3">
      {highlights.map((item) => (
        <div class="rounded-2xl border border-dashed border-black/25 dark:border-white/20 p-4 space-y-2">
          <p class="text-xs uppercase tracking-[0.3em] zag-muted flex items-center gap-2">
            <i class={`${item.icon} text-sm`} aria-hidden="true"></i>
            {item.title}
          </p>
          <p class="text-sm leading-relaxed">{item.description}</p>
        </div>
      ))}
    </div>
  </Section>

  <Section class="py-10 space-y-4">
    <div class="space-y-2">
      <p class="font-display text-xs uppercase tracking-[0.35em] zag-muted">
        Pilihan utama
      </p>
      <h2 class="text-2xl font-display">
        {verifiedProducts.length ? "Produk yang sudah kubuktikan" : "Semua produk rekomendasi"}
      </h2>
      <p class="text-sm sm:text-base max-w-2xl">
        {verifiedProducts.length
          ? "Produk dengan label verified sudah kupakai langsung dan cocok untuk kebutuhan kerja atau produksi konten."
          : "Belum ada label verified, tapi semua produk tetap kurasi pribadi dengan deskripsi lengkap."}
      </p>
    </div>

    <AffiliateProducts
      products={verifiedProducts.length ? verifiedProducts : products}
      title={verifiedProducts.length ? "Sudah dicoba & direkomendasikan" : "Semua produk"}
      context="Klik salah satu kartu untuk langsung menuju toko resminya."
    />
  </Section>

  <Section class="py-12 space-y-6">
    <div class="space-y-3">
      <p class="font-display text-xs uppercase tracking-[0.35em] zag-muted">
        Kategori lengkap
      </p>
      <h2 class="text-2xl font-display">Pilih sesuai kebutuhan</h2>
      <p class="text-sm sm:text-base max-w-3xl">
        Setiap kategori berisi produk dengan fungsi serupa. Gunakan anchor di bawah untuk melompat cepat.
      </p>
      <div class="flex flex-wrap gap-2">
        {categoryProducts.map((category) => (
          <a
            href={`#${slugify(category.name)}`}
            class="px-3 py-2 rounded-full border border-black/20 dark:border-white/25 text-xs uppercase tracking-[0.2em] hover:bg-black/5 dark:hover:bg-white/10"
          >
            {category.name} ({category.items.length})
          </a>
        ))}
      </div>
    </div>
  </Section>

  {categoryProducts.map((category) => (
    <Section id={slugify(category.name)} class="py-10 space-y-4">
      <div class="space-y-2">
        <p class="font-display text-xs uppercase tracking-[0.35em] zag-muted">
          {category.name}
        </p>
        <h3 class="text-xl font-display">Pilihan di kategori {category.name}</h3>
        <p class="text-sm sm:text-base max-w-2xl">
          {category.items.length} produk yang relevan untuk kebutuhan {category.name.toLowerCase()}.
        </p>
      </div>
      <AffiliateProducts
        products={category.items}
        title={`Produk ${category.name}`}
        context="Harga dan promo mengikuti update terbaru di platform masing-masing."
      />
    </Section>
  ))}
</Layout>
