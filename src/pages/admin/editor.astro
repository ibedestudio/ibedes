---
import fs from "node:fs/promises";
import path from "node:path";
import matter from "gray-matter";
import Layout from "../../layouts/Layout.astro";
import { affiliateProducts } from "../../lib/affiliates";
import { GLOBAL } from "../../lib/variables";

export const prerender = false;

const { searchParams } = Astro.url;
const filename = searchParams.get("file");

interface Frontmatter {
    title: string;
    description: string;
    pubDate: string | Date;
    affiliateProducts: string[];
    affiliateContext: string;
    featuredImage?: string;
    [key: string]: any;
}

let content = "";
let frontmatter: Frontmatter = {
    title: "",
    description: "",
    pubDate: new Date().toISOString().split("T")[0],
    affiliateProducts: [],
    affiliateContext: "",
};

if (filename) {
    try {
        const filePath = path.join(process.cwd(), "src/pages/blog", filename);
        const fileContent = await fs.readFile(filePath, "utf-8");
        const parsed = matter(fileContent);
        content = parsed.content;
        frontmatter = { ...frontmatter, ...parsed.data };
        // Handle date format if it's a Date object
        if (frontmatter.pubDate instanceof Date) {
            frontmatter.pubDate = frontmatter.pubDate
                .toISOString()
                .split("T")[0];
        }
    } catch (e) {
        console.error("Error reading file", e);
    }
}

const allProducts = affiliateProducts;
---

<Layout title={`Editor - ${GLOBAL.username}`}>
    <div class="editor-shell">
        <header class="editor-header">
            <div class="editor-header__text">
                <p class="editor-eyebrow">
                    {filename ? "Mode edit" : "Mode draft"}
                </p>
                <h1>{filename ? "Perbarui artikel" : "Artikel baru"}</h1>
                <p>
                    Kelola markdown, metadata, dan afiliasi dari satu layar yang lebih
                    ringkas.
                </p>
            </div>
            <div class="editor-header__actions">
                <a href="/admin" class="editor-button editor-button--ghost">
                    <i class="fa-solid fa-arrow-left-long" aria-hidden="true"></i>
                    <span>Kembali</span>
                </a>
                <a
                    id="view-article-btn"
                    href="#"
                    target="_blank"
                    data-hidden
                    class="editor-button editor-button--soft"
                >
                    <i class="fa-solid fa-eye" aria-hidden="true"></i>
                    <span>Lihat</span>
                </a>
                <button
                    id="save-btn"
                    type="button"
                    class="editor-button editor-button--primary"
                >
                    <i class="fa-solid fa-save" aria-hidden="true"></i>
                    <span>Simpan</span>
                </button>
            </div>
        </header>

        <div class="editor-chip-row">
            <span class="editor-chip" data-filename-chip>
                <i class="fa-regular fa-file-lines" aria-hidden="true"></i>
                <span data-filename-chip-text>{filename || "Belum ada file"}</span>
            </span>
            <span class="editor-chip">
                <i class="fa-regular fa-calendar" aria-hidden="true"></i>
                {frontmatter.pubDate
                    ? new Date(frontmatter.pubDate).toLocaleDateString("id-ID")
                    : "Tanggal otomatis"}
            </span>
            <span class="editor-chip">
                <i class="fa-solid fa-tags" aria-hidden="true"></i>
                <span data-product-count>{frontmatter.affiliateProducts?.length ?? 0}</span>
                produk
            </span>
        </div>

        <div class="editor-grid">
            <section class="editor-panel editor-panel--primary">
                <div class="editor-panel__head">
                    <div>
                        <p class="editor-eyebrow">Konten</p>
                        <h2>Markdown editor</h2>
                    </div>
                    <span class="editor-hint">
                        Gunakan Markdown standar · Cmd/Ctrl + S untuk simpan cepat
                    </span>
                </div>
                <textarea
                    id="content-editor"
                    class="editor-textarea"
                    placeholder="Tulis artikel di sini..."
                    >{content}</textarea
                >
            </section>

            <aside class="editor-stack">
                <div class="editor-card">
                    <div class="editor-card__head">
                        <div>
                            <p class="editor-eyebrow">Metadata</p>
                            <h3>Detail artikel</h3>
                        </div>
                        <span class="editor-pill">
                            {filename ? "Existing" : "Draft"}
                        </span>
                    </div>

                    <div class="editor-field">
                        <label for="filename-input" class="editor-label"
                            >Nama file</label
                        >
                        <input
                            type="text"
                            id="filename-input"
                            value={filename || ""}
                            disabled={!!filename}
                            class="editor-input"
                            placeholder="contoh: kisah-hujan.md"
                        />
                        <p class="editor-hint">
                            Gunakan huruf kecil dan strip untuk pemisah kata.
                        </p>
                    </div>

                    <div class="editor-field">
                        <label for="title-input" class="editor-label">Judul</label>
                        <input
                            type="text"
                            id="title-input"
                            value={frontmatter.title}
                            class="editor-input"
                            placeholder="Judul utama"
                        />
                    </div>

                    <div class="editor-field">
                        <label for="desc-input" class="editor-label"
                            >Deskripsi</label
                        >
                        <textarea
                            id="desc-input"
                            rows="3"
                            class="editor-textarea editor-textarea--small"
                            placeholder="Ringkasan singkat"
                            >{frontmatter.description}</textarea
                        >
                    </div>

                    <div class="editor-field">
                        <label for="date-input" class="editor-label">Tanggal</label>
                        <input
                            type="date"
                            id="date-input"
                            value={frontmatter.pubDate instanceof Date
                                ? frontmatter.pubDate.toISOString().split("T")[0]
                                : frontmatter.pubDate}
                            class="editor-input"
                        />
                    </div>
                </div>

                <div class="editor-card">
                    <div class="editor-card__head">
                        <div>
                            <p class="editor-eyebrow">Media</p>
                            <h3>Gambar unggulan</h3>
                        </div>
                        <span class="editor-pill">Opsional</span>
                    </div>

                    <div class="editor-field">
                        <label for="image-input" class="editor-label"
                            >URL gambar</label
                        >
                        <div class="editor-input-group">
                            <input
                                type="url"
                                id="image-input"
                                value={frontmatter.featuredImage || ""}
                                placeholder="https://..."
                                class="editor-input"
                            />
                            <label class="editor-upload" title="Unggah gambar">
                                <input type="file" id="file-upload" accept="image/*" />
                                <i class="fa-solid fa-upload" aria-hidden="true"></i>
                            </label>
                        </div>
                    </div>

                    <div id="image-preview" class="editor-preview hidden">
                        <img src="" alt="Preview" loading="lazy" />
                    </div>

                    <div class="editor-field">
                        <label for="image-alt-input" class="editor-label"
                            >Alt text</label
                        >
                        <input
                            type="text"
                            id="image-alt-input"
                            value={frontmatter.featuredImageAlt || ""}
                            class="editor-input"
                            placeholder="Deskripsi untuk aksesibilitas"
                        />
                    </div>

                    <div class="editor-field">
                        <label for="image-caption-input" class="editor-label"
                            >Caption / kredit</label
                        >
                        <input
                            type="text"
                            id="image-caption-input"
                            value={frontmatter.featuredImageCaption || ""}
                            class="editor-input"
                            placeholder="Foto oleh ..."
                        />
                    </div>
                </div>

                <div class="editor-card">
                    <div class="editor-card__head">
                        <div>
                            <p class="editor-eyebrow">Afiliasi</p>
                            <h3>Produk tertaut</h3>
                        </div>
                        <span class="editor-pill">
                            {frontmatter.affiliateProducts?.length ?? 0} dipilih
                        </span>
                    </div>

                    <div class="editor-field">
                        <label for="affiliate-context" class="editor-label"
                            >Catatan konteks</label
                        >
                        <input
                            type="text"
                            id="affiliate-context"
                            value={frontmatter.affiliateContext || ""}
                            class="editor-input"
                            placeholder="Contoh: Produk rekomendasi"
                        />
                    </div>

                    <div class="editor-checkbox-list custom-scrollbar">
                        {allProducts.length > 0 ? (
                            allProducts.map((product) => (
                                <label class="editor-checkbox-item">
                                    <input
                                        type="checkbox"
                                        name="affiliate-products"
                                        value={product.id}
                                        checked={
                                            frontmatter.affiliateProducts &&
                                            frontmatter.affiliateProducts.includes(
                                                product.id,
                                            )
                                        }
                                    />
                                    <div class="editor-checkbox-copy">
                                        <span>{product.name}</span>
                                        <small>
                                            {product.platform} · {product.price ?? "-"}
                                        </small>
                                    </div>
                                </label>
                            ))
                        ) : (
                            <p class="editor-empty">
                                Belum ada produk afiliasi yang tersedia.
                            </p>
                        )}
                    </div>
                </div>
            </aside>
        </div>
    </div>

    <script
        define:vars={{
            initialFilename: filename,
            initialFrontmatter: frontmatter,
        }}
    >
        // Handle file upload
        const fileInput = document.getElementById("file-upload");
        const urlInput = document.getElementById("image-input");
        const imagePreview = document.getElementById("image-preview");
        const previewImg = imagePreview?.querySelector("img");
        const viewBtn = document.getElementById("view-article-btn");
        const filenameInput = document.getElementById("filename-input");
        const filenameChipText = document.querySelector(
            "[data-filename-chip-text]",
        );
        const productCountChip = document.querySelector("[data-product-count]");
        const productCheckboxes = Array.from(
            document.querySelectorAll('input[name="affiliate-products"]'),
        );

        let currentFilename = initialFilename ?? "";

        function syncViewButton(target) {
            if (!viewBtn) return;
            if (target) {
                const articleSlug = target.replace(/\.md$/, "");
                viewBtn.href = `/blog/${articleSlug}`;
                viewBtn.removeAttribute("data-hidden");
            } else {
                viewBtn.setAttribute("data-hidden", "true");
            }
        }

        // Show View Article button if editing existing article
        if (currentFilename) {
            syncViewButton(currentFilename);
        }

        function updateFilenameState(newFilename) {
            currentFilename = newFilename;
            if (filenameInput) {
                filenameInput.value = newFilename;
                filenameInput.disabled = true;
            }
            if (filenameChipText) {
                filenameChipText.textContent = newFilename;
            }
            syncViewButton(newFilename);
        }

        function getSelectedProductIds() {
            return productCheckboxes
                .filter((cb) => cb.checked)
                .map((cb) => cb.value);
        }

        function updateProductCountDisplay(count = getSelectedProductIds().length) {
            if (productCountChip) {
                productCountChip.textContent = String(count);
            }
        }

        productCheckboxes.forEach((checkbox) => {
            checkbox.addEventListener("change", () => {
                updateProductCountDisplay();
            });
        });

        updateProductCountDisplay();

        function updatePreview() {
            const url = urlInput.value.trim();
            if (url && imagePreview && previewImg) {
                previewImg.src = url;
                imagePreview.classList.remove("hidden");
            } else if (imagePreview) {
                imagePreview.classList.add("hidden");
            }
        }

        urlInput?.addEventListener("input", updatePreview);
        // Initial check
        updatePreview();

        fileInput?.addEventListener("change", async (e) => {
            const file = e.target.files?.[0];
            if (!file) return;

            const formData = new FormData();
            formData.append("file", file);

            // Show loading state
            const uploadBtn = fileInput.parentElement;
            const originalContent = uploadBtn?.innerHTML;
            if (uploadBtn) {
                uploadBtn.innerHTML =
                    '<i class="fa-solid fa-spinner fa-spin"></i>';
                uploadBtn.style.pointerEvents = "none";
            }

            try {
                const response = await fetch("/api/admin/upload", {
                    method: "POST",
                    body: formData,
                });

                const result = await response.json();

                if (response.ok) {
                    urlInput.value = result.url;
                    updatePreview();
                    if (typeof window.showToast === "function") {
                        window.showToast("Image uploaded successfully!", {
                            type: "success",
                        });
                    }
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                console.error("Upload error:", error);
                if (typeof window.showToast === "function") {
                    window.showToast(error.message || "Failed to upload image", {
                        type: "error",
                    });
                } else {
                    alert("Failed to upload image");
                }
            } finally {
                // Restore button state
                if (uploadBtn && originalContent) {
                    uploadBtn.innerHTML = originalContent;
                    uploadBtn.style.pointerEvents = "auto";
                }
                // Clear input
                fileInput.value = "";
            }
        });

        const saveBtn = document.getElementById("save-btn");

        saveBtn.addEventListener("click", async () => {
            let filename = filenameInput?.value.trim() ?? "";

            if (!filename) {
                alert("Please enter a filename");
                return;
            }

            if (!filename.endsWith(".md")) {
                filename += ".md";
                if (filenameInput) {
                    filenameInput.value = filename;
                }
            }

            const title = document.getElementById("title-input").value;
            const description = document.getElementById("desc-input").value;
            const pubDate = document.getElementById("date-input").value;
            const featuredImage = document.getElementById("image-input").value;
            const featuredImageAlt =
                document.getElementById("image-alt-input").value;
            const featuredImageCaption = document.getElementById(
                "image-caption-input",
            ).value;
            const affiliateContext =
                document.getElementById("affiliate-context").value;
            const contentBody = document.getElementById("content-editor").value;

            // Get selected products
            const selectedProducts = getSelectedProductIds();

            // Construct Frontmatter
            const escapeYaml = (str) => str.replace(/"/g, '\\"');

            // Start with existing frontmatter to preserve other fields (like layout, tags, etc)
            // We exclude the fields we are explicitly handling to avoid duplicates
            const {
                title: _,
                description: __,
                pubDate: ___,
                featuredImage: ____,
                featuredImageAlt: _____,
                featuredImageCaption: ______,
                affiliateProducts: _______,
                affiliateContext: ________,
                ...preservedFrontmatter
            } = initialFrontmatter;

            // Ensure layout is present if it wasn't there
            if (!preservedFrontmatter.layout) {
                preservedFrontmatter.layout = "../../layouts/BlogLayout.astro";
            }

            const frontmatterLines = ["---"];

            // Add preserved fields
            for (const [key, value] of Object.entries(preservedFrontmatter)) {
                if (Array.isArray(value)) {
                    frontmatterLines.push(`${key}:`);
                    value.forEach((item) => frontmatterLines.push(`  - "${item}"`));
                } else if (typeof value === "object" && value !== null) {
                    frontmatterLines.push(`${key}:`);
                    for (const [k, v] of Object.entries(value)) {
                        frontmatterLines.push(`  ${k}: "${v}"`);
                    }
                } else {
                    frontmatterLines.push(`${key}: ${JSON.stringify(value)}`);
                }
            }

            // Add explicitly managed fields
            frontmatterLines.push(`title: "${escapeYaml(title)}"`);
            frontmatterLines.push(`description: "${escapeYaml(description)}"`);
            frontmatterLines.push(`pubDate: "${pubDate}"`);

            if (featuredImage) {
                frontmatterLines.push(
                    `featuredImage: "${escapeYaml(featuredImage)}"`,
                );
            }

            if (featuredImageAlt) {
                frontmatterLines.push(
                    `featuredImageAlt: "${escapeYaml(featuredImageAlt)}"`,
                );
            }

            if (featuredImageCaption) {
                frontmatterLines.push(
                    `featuredImageCaption: "${escapeYaml(featuredImageCaption)}"`,
                );
            }

            if (selectedProducts.length > 0) {
                frontmatterLines.push("affiliateProducts:");
                selectedProducts.forEach((id) => {
                    frontmatterLines.push(`  - "${id}"`);
                });
            }

            if (affiliateContext) {
                frontmatterLines.push(
                    `affiliateContext: "${escapeYaml(affiliateContext)}"`,
                );
            }

            frontmatterLines.push("---");
            frontmatterLines.push("");
            frontmatterLines.push(contentBody);

            const fullContent = frontmatterLines.join("\n");

            try {
                saveBtn.innerHTML =
                    '<i class="fa-solid fa-spinner fa-spin"></i> Menyimpan...';
                saveBtn.disabled = true;

                const response = await fetch("/api/admin/save", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        filename,
                        content: fullContent,
                    }),
                });

                const result = await response.json();

                if (response.ok) {
                    // Show success toast
                    if (typeof window.showToast === "function") {
                        window.showToast("Article saved successfully!", {
                            type: "success",
                        });
                    }

                    // Show View Article button
                    const viewBtn = document.getElementById("view-article-btn");
                    const articleSlug = filename.replace(".md", "");
                    const articleUrl = `/blog/${articleSlug}`;

                    if (viewBtn) {
                        viewBtn.href = articleUrl;
                        viewBtn.removeAttribute("data-hidden");
                    }

                    updateFilenameState(filename);
                    updateProductCountDisplay(selectedProducts.length);

                    saveBtn.classList.add("is-success");
                    saveBtn.innerHTML =
                        '<i class="fa-solid fa-check"></i> Tersimpan';

                    setTimeout(() => {
                        saveBtn.classList.remove("is-success");
                        saveBtn.innerHTML =
                            '<i class="fa-solid fa-save"></i> Simpan';
                        saveBtn.disabled = false;
                    }, 1600);
                } else {
                    alert("Error saving: " + result.error);
                    saveBtn.innerHTML =
                        '<i class="fa-solid fa-save"></i> Simpan';
                    saveBtn.disabled = false;
                }
            } catch (e) {
                console.error(e);
                // Show error toast
                if (typeof window.showToast === "function") {
                    window.showToast("Failed to save article", {
                        type: "error",
                    });
                }
                saveBtn.innerHTML = '<i class="fa-solid fa-save"></i> Simpan';
                saveBtn.disabled = false;
            }
        });
    </script>

    <style>
        .editor-shell {
            max-width: 1100px;
            margin: 0 auto;
            padding: 1.5rem 1.25rem 4rem;
            --editor-border: 1px solid color-mix(
                in srgb,
                var(--color-foreground) 14%,
                transparent
            );
            --editor-card-bg: color-mix(
                in srgb,
                var(--color-card) 92%,
                transparent
            );
            --editor-radius: 1rem;
        }

        .editor-header {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            padding: 1.25rem;
            border: var(--editor-border);
            border-radius: var(--editor-radius);
            background: var(--editor-card-bg);
        }

        @media (min-width: 768px) {
            .editor-header {
                flex-direction: row;
                align-items: flex-start;
                justify-content: space-between;
            }
        }

        .editor-header__text h1 {
            font-family: var(--font-display);
            font-size: clamp(1.4rem, 3vw, 1.9rem);
            margin: 0;
        }

        .editor-header__text p {
            margin: 0.35rem 0 0;
            max-width: 48ch;
            color: color-mix(in srgb, var(--color-foreground) 70%, transparent);
        }

        .editor-header__actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .editor-eyebrow {
            font-size: 0.7rem;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            color: color-mix(in srgb, var(--color-foreground) 55%, transparent);
            margin: 0 0 0.2rem 0;
        }

        .editor-button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.35rem;
            border-radius: 0.85rem;
            padding: 0.6rem 1.1rem;
            border: var(--editor-border);
            font-family: var(--font-mono);
            font-size: 0.9rem;
            cursor: pointer;
            background: transparent;
            color: inherit;
            transition: transform 150ms ease, border-color 150ms ease,
                background-color 150ms ease;
        }

        .editor-button[data-hidden] {
            display: none !important;
        }

        .editor-button--ghost {
            background: transparent;
        }

        .editor-button--soft {
            background: color-mix(in srgb, var(--color-foreground) 4%, transparent);
        }

        .editor-button--primary {
            background: var(--color-primary);
            border-color: color-mix(in srgb, var(--color-primary) 60%, transparent);
            color: var(--color-background);
        }

        .editor-button.is-success {
            background: color-mix(in srgb, var(--color-primary) 20%, var(--color-success, #0f9d58));
            border-color: color-mix(in srgb, var(--color-primary) 50%, transparent);
        }

        .editor-button:hover,
        .editor-button:focus-visible {
            transform: translateY(-1px);
        }

        .editor-chip-row {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0 1.25rem;
        }

        .editor-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.4rem 0.9rem;
            border-radius: 999px;
            border: var(--editor-border);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .editor-grid {
            display: grid;
            grid-template-columns: minmax(0, 2fr) minmax(0, 1fr);
            gap: 1.25rem;
        }

        @media (max-width: 1024px) {
            .editor-grid {
                grid-template-columns: 1fr;
            }
        }

        .editor-panel {
            border: var(--editor-border);
            border-radius: var(--editor-radius);
            background: var(--editor-card-bg);
            padding: 1rem;
        }

        .editor-panel__head {
            display: flex;
            justify-content: space-between;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 0.75rem;
        }

        .editor-hint {
            font-size: 0.8rem;
            color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
        }

        .editor-textarea {
            width: 100%;
            min-height: 60vh;
            border-radius: 0.9rem;
            border: var(--editor-border);
            background: transparent;
            padding: 0.85rem 1rem;
            font-family: var(--font-mono);
            font-size: 0.95rem;
            resize: vertical;
            line-height: 1.55;
        }

        .editor-textarea--small {
            min-height: 90px;
        }

        .editor-stack {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .editor-card {
            border: var(--editor-border);
            border-radius: var(--editor-radius);
            background: var(--editor-card-bg);
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.85rem;
        }

        .editor-card__head {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.5rem;
        }

        .editor-card__head h3 {
            margin: 0;
            font-size: 1rem;
        }

        .editor-pill {
            font-size: 0.75rem;
            padding: 0.15rem 0.6rem;
            border-radius: 999px;
            border: var(--editor-border);
        }

        .editor-field {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }

        .editor-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
        }

        .editor-input,
        .editor-input-group input {
            border: var(--editor-border);
            border-radius: 0.8rem;
            background: transparent;
            padding: 0.65rem 0.9rem;
            font-family: var(--font-mono);
            font-size: 0.9rem;
            width: 100%;
        }

        .editor-input:disabled {
            opacity: 0.65;
        }

        .editor-input-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .editor-upload {
            width: 2.6rem;
            height: 2.6rem;
            border-radius: 0.8rem;
            border: var(--editor-border);
            display: grid;
            place-items: center;
            cursor: pointer;
        }

        .editor-upload input {
            display: none;
        }

        .editor-preview {
            border-radius: 0.85rem;
            border: var(--editor-border);
            padding: 0.2rem;
            background: color-mix(
                in srgb,
                var(--color-background) 95%,
                transparent
            );
        }

        .editor-preview img {
            width: 100%;
            height: auto;
            border-radius: 0.7rem;
            object-fit: cover;
        }

        .editor-checkbox-list {
            max-height: 320px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
            padding-right: 0.25rem;
        }

        .editor-checkbox-item {
            display: flex;
            gap: 0.6rem;
            border: var(--editor-border);
            border-radius: 0.8rem;
            padding: 0.55rem 0.7rem;
            align-items: flex-start;
        }

        .editor-checkbox-item input {
            margin-top: 0.2rem;
        }

        .editor-checkbox-copy span {
            display: block;
            font-weight: 600;
            margin-bottom: 0.1rem;
        }

        .editor-checkbox-copy small {
            color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
        }

        .editor-empty {
            font-size: 0.9rem;
            color: color-mix(in srgb, var(--color-foreground) 65%, transparent);
            text-align: center;
            padding: 1rem 0;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: color-mix(in srgb, var(--color-foreground) 25%, transparent);
            border-radius: 999px;
        }

        .hidden {
            display: none !important;
        }
    </style>
</Layout>
