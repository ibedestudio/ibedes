---
import { GLOBAL } from "../lib/variables";
import Anchor from "./common/Anchor.astro";
import ThemeToggle from "./ThemeToggle.astro";
---

<header class="zag-bg zag-border-b zag-transition sticky top-0 w-full z-10">
  <div
    class="zag-bg zag-transition sm:hidden relative z-50 py-4 flex items-center"
  >
    <button class="px-4 touch-target" aria-label="Toggle navigation menu" aria-expanded="false">
      <i class="fa-solid fa-bars text-3xl zag-text zag-transition"></i>
    </button>
  </div>
  <nav
    class="zag-bg zag-border-b zag-transition fixed sm:relative inset-x-0 top-0 h-auto sm:px-4 flex justify-between flex-col gap-8 py-4 text-xl sm:flex-row max-w-2xl mx-auto sm:pt-4 sm:border-none"
  >
    <div
      class="flex flex-col font-mono font-medium gap-4 sm:flex-row px-4 sm:px-0 mt-16 sm:mt-0"
    >
      {
        Object.entries(GLOBAL.menu).map((i) => (
          <Anchor url={i[1]} class="touch-target">{i[0]}</Anchor>
        ))
      }
    </div>
    <div class="flex gap-4 justify-between px-4 sm:px-0">
      {
        GLOBAL.githubProfile && (
          <Anchor
            url={GLOBAL.githubProfile}
            aria-label="Zaggonaut GitHub Repository"
            class="touch-target !no-underline"
          >
            <i class="fa-brands fa-github text-3xl zag-text zag-transition" />
          </Anchor>
        )
      }
      <ThemeToggle />
    </div>
  </nav>
</header>

<script>
  const button = document.querySelector<HTMLButtonElement>(
    "button[aria-label='Toggle navigation menu']",
  );
  const nav = document.querySelector("nav");
  let isOpen = false;

  function updateNavState() {
    const isMobile = window.matchMedia("(max-width: 640px)").matches;
    if (isMobile) {
      nav!.style.transform = isOpen ? "translateY(0)" : "translateY(-100%)";
    } else {
      nav!.style.transform = "translateY(0)";
      isOpen = false;
    }

    button?.setAttribute("aria-expanded", String(isOpen));
  }

  function toggleNav() {
    isOpen = !isOpen;
    updateNavState();
  }

  button?.addEventListener("click", toggleNav);
  window.addEventListener("resize", updateNavState);

  updateNavState();
</script>
