---
import Layout from "../../layouts/Layout.astro";
import Section from "../../components/common/Section.astro";
import { GLOBAL } from "../../lib/variables";
import type { ServiceDetail } from "../../lib/services";
import { SERVICES } from "../../lib/services";
import Breadcrumbs from "../../components/common/Breadcrumbs.astro";

export async function getStaticPaths() {
  return SERVICES.map((service) => ({
    params: { slug: service.slug },
    props: { service },
  }));
}

interface Props {
  service: ServiceDetail;
}

const { service } = Astro.props as Props;
const contactPhone = GLOBAL.contactPhone ?? "0823-1777-7008";
const whatsappLink = GLOBAL.contactWhatsApp ?? "https://wa.link/b1hzai";
const phoneHref = `tel:${contactPhone.replace(/\D+/g, "")}`;
const breadcrumbs = [
  { label: "Home", url: "/" },
  { label: "Services", url: "/services" },
  { label: service.title },
];
---

<Layout>
  <Fragment slot="head">
    <title>{service.title} • {GLOBAL.username}</title>
    <meta name="description" content={service.summary} />
    <meta property="og:title" content={`${service.title} • ${GLOBAL.username}`} />
    <meta property="og:description" content={service.summary} />
    <meta property="og:image" content={`${GLOBAL.rootUrl}/${GLOBAL.profileImage}`} />
    <meta property="og:url" content={`${GLOBAL.rootUrl}/services/${service.slug}`} />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={`${service.title} • ${GLOBAL.username}`} />
    <meta name="twitter:description" content={service.summary} />
    <meta name="twitter:image" content={`${GLOBAL.rootUrl}/${GLOBAL.profileImage}`} />
    <meta http-equiv="content-language" content="id" />
    <meta name="language" content="Indonesia" />
    <link rel="canonical" href={`${GLOBAL.rootUrl}/services/${service.slug}`} />
  </Fragment>

  <Section class="py-16 space-y-8">
    <Breadcrumbs items={breadcrumbs} />
    <div class="space-y-4">
      <p class="font-display text-xs uppercase tracking-[0.35em] zag-muted">
        {service.bestFor}
      </p>
      <h1 class="text-3xl sm:text-4xl font-display leading-tight">
        {service.title}
      </h1>
      <p class="text-base sm:text-lg max-w-2xl">{service.summary}</p>
      <p class="text-sm zag-muted max-w-2xl">{service.intro}</p>
    </div>

    <div class="flex flex-wrap gap-3">
      {service.problems.map((item) => (
        <span class="text-xs uppercase tracking-[0.25em] border border-black/20 dark:border-white/30 rounded-full px-4 py-2">
          {item}
        </span>
      ))}
    </div>
  </Section>

  <Section class="py-10 space-y-6">
    <div class="space-y-2">
      <p class="font-display text-xs uppercase tracking-[0.35em] zag-muted">
        Paket & Harga
      </p>
      <h2 class="text-2xl font-display">Pricelist yang bisa disesuaikan</h2>
      <p class="text-sm zag-muted max-w-2xl">
        Semua paket fleksibel untuk menyesuaikan kebutuhan dan timeline kamu. Pilih yang paling dekat dengan kebutuhanmu, sisanya bisa kita atur saat briefing.
      </p>
    </div>
    <div class="grid gap-6 md:grid-cols-3">
      {service.priceList.map((tier) => (
        <article
          class:list={[
            "rounded-2xl border border-black/20 dark:border-white/30 p-6 flex flex-col gap-4",
            tier.highlight ? "price-card--highlight" : "",
          ]}
        >
          <div class="space-y-2">
            <p class="text-xs uppercase tracking-[0.25em] zag-muted">{tier.name}</p>
            <p class="text-xl font-display">{tier.price}</p>
            <p class="text-sm">{tier.description}</p>
          </div>
          <ul class="space-y-2 text-sm leading-relaxed">
            {tier.features.map((feature) => (
              <li class="flex gap-2">
                <span aria-hidden="true">—</span>
                <span>{feature}</span>
              </li>
            ))}
          </ul>
        </article>
      ))}
    </div>
  </Section>

  <Section class="py-10 space-y-6">
    <div class="space-y-2">
      <p class="font-display text-xs uppercase tracking-[0.35em] zag-muted">
        Benefit
      </p>
      <h2 class="text-2xl font-display">Kenapa layanan ini efektif</h2>
    </div>
    <div class="grid gap-4 md:grid-cols-2">
      {service.benefits.map((benefit) => (
        <div class="rounded-2xl border border-dashed border-black/20 dark:border-white/30 p-4">
          <p class="text-base leading-relaxed">{benefit}</p>
        </div>
      ))}
    </div>
  </Section>

  <Section class="py-10 space-y-6">
    <div class="space-y-2">
      <p class="font-display text-xs uppercase tracking-[0.35em] zag-muted">
        Proses
      </p>
      <h2 class="text-2xl font-display">Cara kita bekerja</h2>
    </div>
    <div class="space-y-4">
      {service.process.map((step, index) => (
        <div class="flex gap-4">
          <div class="flex flex-col items-center">
            <span class="w-8 h-8 rounded-full border border-black/30 dark:border-white/30 flex items-center justify-center font-display text-sm">
              {index + 1}
            </span>
            {index < service.process.length - 1 ? (
              <span class="flex-1 w-px bg-black/20 dark:bg-white/30 grow"></span>
            ) : null}
          </div>
          <div class="pb-6 border-b border-dashed border-black/20 dark:border-white/20 w-full">
            <h3 class="text-xl font-display">{step.title}</h3>
            <p class="text-sm leading-relaxed">{step.description}</p>
          </div>
        </div>
      ))}
    </div>
  </Section>

  <Section class="py-16">
    <div class="rounded-2xl border border-black/20 dark:border-white/30 p-8 space-y-6">
      <div class="space-y-3">
        <p class="font-display text-xs uppercase tracking-[0.35em] zag-muted">
          Siap mulai?
        </p>
        <h2 class="text-2xl sm:text-3xl font-display">
          Kirim brief singkat, gratis konsultasi awal.
        </h2>
        <p class="text-base sm:text-lg max-w-2xl">
          Ceritakan target, timeline ideal, dan budget range. Dalam 24 jam kami kirimkan kombinasi paket + action plan awal supaya kamu bisa langsung ambil keputusan.
        </p>
      </div>
      <div class="flex flex-wrap gap-3">
        <a
          href={whatsappLink}
          target="_blank"
          rel="noopener noreferrer"
          class="cta-button cta-button--primary w-full sm:w-auto"
        >
          Chat via WhatsApp
        </a>
        <a
          href={phoneHref}
          class="cta-button cta-button--secondary w-full sm:w-auto"
        >
          Hubungi {contactPhone}
        </a>
      </div>
    </div>
  </Section>
</Layout>

<style>
  :global(.price-card--highlight) {
    border-width: 2px;
    border-color: var(--color-zag-dark);
    background: linear-gradient(135deg, rgba(16, 16, 16, 0.05), transparent);
  }

  :global(.dark .price-card--highlight) {
    border-color: var(--color-zag-light);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), transparent);
  }
</style>
