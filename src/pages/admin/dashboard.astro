---
import fs from "node:fs/promises";
import path from "node:path";
import matter from "gray-matter";
import Layout from "../../layouts/Layout.astro";
import { GLOBAL } from "../../lib/variables";
import { loadAffiliateProducts } from "../../lib/affiliates";
import { formatRupiah } from "../../lib/utils";

export const prerender = false;

const blogDir = path.join(process.cwd(), "src/pages/blog");
const affiliateProducts = await loadAffiliateProducts();
let articles = [];
let totalWords = 0;
let totalReadingTime = 0;

try {
    const files = await fs.readdir(blogDir);
    console.log(`[Admin Dashboard] Found ${files.length} files in ${blogDir}`);
    for (const file of files) {
        if (file.endsWith(".md")) {
            try {
                const content = await fs.readFile(
                    path.join(blogDir, file),
                    "utf-8",
                );
                const { data, content: markdownContent } = matter(content);

                // Calculate reading time (average 200 words per minute)
                const words = markdownContent.split(/\s+/).length;
                const readingTime = Math.ceil(words / 200);
                totalWords += words;
                totalReadingTime += readingTime;

                articles.push({
                    filename: file,
                    title: data.title || file,
                    description: data.description || "",
                    date: data.pubDate || data.date || "",
                    affiliateProducts: data.affiliateProducts || [],
                    words,
                    readingTime,
                });
            } catch (err) {
                console.error(`[Admin Dashboard] Error parsing ${file}:`, err);
            }
        }
    }
} catch (e) {
    console.error("[Admin Dashboard] Error reading blog directory", e);
}

// Sort by date if available, otherwise filename
articles.sort((a, b) => {
    if (a.date && b.date)
        return new Date(b.date).getTime() - new Date(a.date).getTime();
    return a.filename.localeCompare(b.filename);
});

const stats = {
    totalArticles: articles.length,
    totalProducts: affiliateProducts.length,
    totalWords,
    totalReadingTime,
    averageWordsPerArticle:
        Math.round(totalWords / (articles.length || 1)) || 0,
};

const articlesWithAffiliates = articles.filter(
    (article) => (article.affiliateProducts?.length ?? 0) > 0,
);

const affiliateCoverage = stats.totalArticles
    ? Math.round((articlesWithAffiliates.length / stats.totalArticles) * 100)
    : 0;

const averageProductsPerArticle = stats.totalArticles
    ? Number(
          (
              articles.reduce(
                  (sum, article) =>
                      sum + (article.affiliateProducts?.length ?? 0),
                  0,
              ) / stats.totalArticles
          ).toFixed(1),
      )
    : 0;

const formatNotificationTime = (value: string) => {
    const target = new Date(value);
    if (Number.isNaN(target.getTime())) return "Baru saja";
    const diffMs = Date.now() - target.getTime();
    const diffMinutes = Math.round(diffMs / 60000);
    if (diffMinutes < 1) return "Baru saja";
    if (diffMinutes < 60) return `${diffMinutes} menit lalu`;
    const diffHours = Math.round(diffMinutes / 60);
    if (diffHours < 24) return `${diffHours} jam lalu`;
    const diffDays = Math.round(diffHours / 24);
    return `${diffDays} hari lalu`;
};

const formatNotificationType = (value: string) => {
    if (value === "comment") return "Komentar";
    if (value === "like") return "Love";
    if (value === "message") return "Pesan";
    return "Sistem";
};

const notifications = [
    {
        id: "notif-comment-01",
        type: "comment",
        title: "Komentar baru",
        message: "Rani membalas diskusi di artikel produktivitas.",
        time: new Date(Date.now() - 5 * 60 * 1000).toISOString(),
        status: "unread",
        href: "/blog/menumbuhkan-kebiasaan-baca",
        priority: "high",
        category: "Engagement",
        source: "manual",
        tags: ["komentar", "artikel"],
    },
    {
        id: "notif-like-02",
        type: "like",
        title: "Love diterima",
        message: "Artikel UX Writing mendapat 12 love baru hari ini.",
        time: new Date(Date.now() - 25 * 60 * 1000).toISOString(),
        status: "unread",
        href: "/blog/ux-writing-untuk-pemula",
        priority: "medium",
        category: "Engagement",
        source: "manual",
        tags: ["reaksi", "artikel"],
    },
    {
        id: "notif-message-03",
        type: "message",
        title: "Kotak masuk",
        message: "Ada pertanyaan baru dari halaman kontak.",
        time: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
        status: "unread",
        href: "/admin/messages",
        priority: "medium",
        category: "Support",
        source: "manual",
        tags: ["pertanyaan", "kontak"],
    },
    {
        id: "notif-system-03",
        type: "system",
        title: "Aksi diperlukan",
        message: "Ada 2 produk afiliasi belum memiliki deskripsi lengkap.",
        time: new Date(Date.now() - 26 * 60 * 60 * 1000).toISOString(),
        status: "read",
        href: "/admin/add-product",
        priority: "high",
        category: "Konten",
        source: "manual",
        tags: ["afiliasi", "kelengkapan"],
    },
    {
        id: "notif-system-04",
        type: "system",
        title: "Backup mingguan siap",
        message: "Pencadangan situs otomatis selesai tanpa error.",
        time: new Date(Date.now() - 40 * 60 * 60 * 1000).toISOString(),
        status: "read",
        priority: "low",
        category: "Operasional",
        source: "manual",
        tags: ["backup", "infra"],
    },
    {
        id: "notif-comment-05",
        type: "comment",
        title: "Diskusi trending",
        message: "Ada 6 balasan baru pada artikel desain berkelanjutan.",
        time: new Date(Date.now() - 75 * 60 * 60 * 1000).toISOString(),
        status: "read",
        href: "/blog/desain-berkelanjutan",
        priority: "high",
        category: "Engagement",
        source: "manual",
        tags: ["diskusi", "tren"],
    },
];

const unreadNotifications = notifications.filter(
    (item) => item.status === "unread",
).length;

const latestNotificationTime =
    notifications[0]?.time ?? new Date().toISOString();

const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL ?? "";
const supabaseAnonKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY ?? "";
const supabaseEnabled = Boolean(supabaseUrl && supabaseAnonKey);

const mobileQuickActions = [
    {
        icon: "fa-plus",
        label: "Artikel",
        href: "/admin/editor",
        accent: "primary",
        description: "Buat tulisan baru",
    },
    {
        icon: "fa-tag",
        label: "Produk",
        href: "/admin/add-product",
        accent: "muted",
        description: "Tambah afiliasi",
    },
    {
        icon: "fa-list",
        label: "Metadata",
        href: "/admin/metadata",
        accent: "muted",
        description: "Atur SEO",
    },
];

const adminTabs = [
    {
        id: "overview",
        icon: "fa-chart-line",
        tooltip: "Overview",
    },
    {
        id: "articles",
        icon: "fa-newspaper",
        tooltip: "Articles",
    },
    {
        id: "products",
        icon: "fa-tags",
        tooltip: "Products",
    },
    {
        id: "analytics",
        icon: "fa-chart-bar",
        tooltip: "Analytics",
    },
    {
        id: "settings",
        icon: "fa-gear",
        tooltip: "Settings",
    },
];

const overviewStats = [
    {
        label: "Artikel",
        value: stats.totalArticles,
        meta: "Konten terbit",
        icon: "fa-solid fa-newspaper",
    },
    {
        label: "Produk",
        value: stats.totalProducts,
        meta: "Afiliasi aktif",
        icon: "fa-solid fa-tag",
    },
    {
        label: "Total Kata",
        value: stats.totalWords.toLocaleString(),
        meta: "Volume tulisan",
        icon: "fa-solid fa-file-word",
    },
    {
        label: "Waktu Baca",
        value: `${stats.totalReadingTime} m`,
        meta: "Akumulasi",
        icon: "fa-solid fa-stopwatch",
    },
];

const previewProducts = affiliateProducts.slice(0, 3);
---

<Layout title={`Admin Dashboard - ${GLOBAL.username}`}>
    <div class="admin-shell">
        <header class="admin-header">
            <div class="admin-header__text">
                <h1 class="admin-title">Admin Dashboard</h1>
                <p class="admin-subtitle">
                    Kelola konten, produk, dan analisis dengan antarmuka yang
                    compact.
                </p>
            </div>
            <div class="admin-header__actions">
                <a
                    href="#notifications"
                    class="icon-button admin-notification-button"
                    data-notification-trigger
                    aria-label={`Lihat notifikasi (${unreadNotifications} baru)`}
                >
                    <i class="fa-solid fa-bell" aria-hidden="true" />
                    <span
                        class="admin-notification-badge"
                        data-unread-badge
                        hidden={unreadNotifications === 0}
                        aria-hidden="true"
                    >
                        {unreadNotifications}
                    </span>
                </a>
                <div class="admin-quick-actions" aria-label="Quick actions">
                    {
                        mobileQuickActions.map((action) => (
                            <a
                                href={action.href}
                                class="admin-quick-action-icon"
                                data-accent={action.accent}
                                title={action.description}
                            >
                                <i class={`fa-solid ${action.icon}`} />
                            </a>
                        ))
                    }
                </div>
            </div>
        </header>

        <div class="tab-content">
            <section
                id="overview"
                class="tab-pane active"
                role="tabpanel"
                aria-labelledby="overview-tab"
            >
                <div class="admin-panel admin-panel--grid">
                    {
                        overviewStats.map((stat) => (
                            <article class="admin-stat-card">
                                <div
                                    class="admin-stat-card__icon"
                                    aria-hidden="true"
                                >
                                    <i class={stat.icon} />
                                </div>
                                <div>
                                    <p class="admin-stat-card__label">
                                        {stat.label}
                                    </p>
                                    <p class="admin-stat-card__value">
                                        {stat.value}
                                    </p>
                                    <p class="admin-stat-card__meta">
                                        {stat.meta}
                                    </p>
                                </div>
                            </article>
                        ))
                    }
                </div>

                <div class="admin-panel admin-panel--split">
                    <div class="admin-card">
                        <div class="admin-card__header">
                            <div>
                                <p class="admin-eyebrow">Aktivitas</p>
                                <h2>Artikel terbaru</h2>
                            </div>
                            <button
                                class="admin-link-button"
                                type="button"
                                onclick="switchTab('articles')"
                            >
                                Kelola semua
                                <i
                                    class="fa-solid fa-arrow-right"
                                    aria-hidden="true"></i>
                            </button>
                        </div>
                        <div class="admin-list">
                            {
                                articles.slice(0, 5).map((article) => (
                                    <article class="admin-list__item">
                                        <div>
                                            <p class="admin-list__title">
                                                {article.title}
                                            </p>
                                            <p class="admin-list__meta">
                                                {article.date
                                                    ? new Date(
                                                          article.date,
                                                      ).toLocaleDateString()
                                                    : "Belum ada tanggal"}
                                                · {article.words} kata ·{" "}
                                                {article.readingTime} menit
                                            </p>
                                            {article.affiliateProducts
                                                ?.length ? (
                                                <span class="admin-tag">
                                                    <i
                                                        class="fa-solid fa-link"
                                                        aria-hidden="true"
                                                    />
                                                    {
                                                        article
                                                            .affiliateProducts
                                                            .length
                                                    }{" "}
                                                    produk
                                                </span>
                                            ) : null}
                                        </div>
                                        <div class="admin-row-actions">
                                            <a
                                                href={`/blog/${article.filename.replace(".md", "")}`}
                                                target="_blank"
                                                class="icon-button"
                                                title="Lihat artikel"
                                            >
                                                <i class="fa-solid fa-eye" />
                                            </a>
                                            <a
                                                href={`/admin/editor?file=${article.filename}`}
                                                class="icon-button"
                                                title="Edit artikel"
                                            >
                                                <i class="fa-solid fa-pen-to-square" />
                                            </a>
                                            <button
                                                type="button"
                                                class="icon-button icon-button--danger delete-btn"
                                                data-filename={article.filename}
                                                title="Hapus artikel"
                                            >
                                                <i class="fa-solid fa-trash" />
                                            </button>
                                        </div>
                                    </article>
                                ))
                            }
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="admin-card__header">
                            <div>
                                <p class="admin-eyebrow">Produk</p>
                                <h2>Snapshot afiliasi</h2>
                            </div>
                            <span class="admin-tag">
                                {affiliateCoverage}% artikel terhubung
                            </span>
                        </div>
                        <div class="admin-product-list">
                            {
                                previewProducts.length === 0 && (
                                    <p class="admin-empty">
                                        Belum ada produk yang ditautkan.
                                    </p>
                                )
                            }
                            {
                                previewProducts.map((product) => (
                                    <article class="admin-product">
                                        <div class="admin-product__media">
                                            <img
                                                src={product.image}
                                                alt={product.name}
                                                loading="lazy"
                                            />
                                        </div>
                                        <div class="admin-product__body">
                                            <p class="admin-product__title">
                                                {product.name}
                                            </p>
                                            <p class="admin-product__meta">
                                                {product.category ??
                                                    "Kategori belum diisi"}
                                            </p>
                                            <p class="admin-product__price">
                                                {formatRupiah(product.price)}
                                                {product.discount && (
                                                    <span class="admin-pill-badge">
                                                        {product.discount} OFF
                                                    </span>
                                                )}
                                            </p>
                                        </div>
                                    </article>
                                ))
                            }
                        </div>
                        <div class="admin-card__footer">
                            <button
                                type="button"
                                class="admin-link-button"
                                onclick="switchTab('products')"
                            >
                                Kelola produk
                                <i
                                    class="fa-solid fa-arrow-right"
                                    aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="admin-card" id="notifications">
                    <div class="admin-card__header admin-card__header--stacked">
                        <div>
                            <p class="admin-eyebrow">Notifikasi</p>
                            <h2>Aktivitas terbaru</h2>
                        </div>
                        <div class="admin-notifications__summary">
                            <div
                                class="admin-notifications__pill admin-notifications__pill--accent"
                            >
                                <div class="admin-notifications__pill-icon">
                                    <i class="fa-solid fa-circle-dot" aria-hidden="true"></i>
                                </div>
                                <div class="admin-notifications__pill-body">
                                    <p class="admin-notifications__pill-label">
                                        Belum dibaca
                                    </p>
                                    <p
                                        class="admin-notifications__pill-value"
                                        data-unread-count
                                        data-unread-pill-count
                                    >
                                        {unreadNotifications} notif
                                    </p>
                                </div>
                            </div>
                            <div class="admin-notifications__pill">
                                <div class="admin-notifications__pill-icon admin-notifications__pill-icon--warning">
                                    <i class="fa-solid fa-signal" aria-hidden="true"></i>
                                </div>
                                <div class="admin-notifications__pill-body">
                                    <p class="admin-notifications__pill-label">
                                        Prioritas tinggi
                                    </p>
                                    <p
                                        class="admin-notifications__pill-value"
                                        data-priority-count
                                    >
                                        0 item
                                    </p>
                                </div>
                            </div>
                            <div class="admin-notifications__pill">
                                <div class="admin-notifications__pill-icon">
                                    <i class="fa-regular fa-bell" aria-hidden="true"></i>
                                </div>
                                <div class="admin-notifications__pill-body">
                                    <p class="admin-notifications__pill-label">
                                        Total notifikasi
                                    </p>
                                    <p
                                        class="admin-notifications__pill-value"
                                        data-total-count
                                    >
                                        {notifications.length} notifikasi
                                    </p>
                                </div>
                            </div>
                            <div class="admin-notifications__pill">
                                <div class="admin-notifications__pill-icon admin-notifications__pill-icon--success">
                                    <i class="fa-solid fa-rotate" aria-hidden="true"></i>
                                </div>
                                <div class="admin-notifications__pill-body">
                                    <p class="admin-notifications__pill-label">
                                        Terakhir diperbarui
                                    </p>
                                    <p class="admin-notifications__pill-value">
                                        <span data-latest-time>
                                            {formatNotificationTime(latestNotificationTime)}
                                        </span>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="admin-notifications__controls">
                            <div class="admin-notifications__toolbar">
                                <div class="admin-notifications__search">
                                    <i
                                        class="fa-solid fa-magnifying-glass"
                                        aria-hidden="true"
                                    ></i>
                                    <input
                                        type="search"
                                        placeholder="Cari judul, pesan, atau tag..."
                                        aria-label="Cari notifikasi"
                                        data-notification-search
                                        autocomplete="off"
                                    />
                                </div>
                                <div class="admin-notifications__control-actions">
                                    <button
                                        type="button"
                                        class="admin-chip admin-chip--ghost"
                                        data-reset-filters
                                    >
                                        Reset filter
                                    </button>
                                    <button
                                        type="button"
                                        class="admin-chip admin-chip--muted"
                                        data-mark-all
                                    >
                                        Tandai semua dibaca
                                    </button>
                                    <button
                                        type="button"
                                        class="admin-chip admin-chip--primary"
                                        data-mark-selected
                                    >
                                        Tandai dipilih
                                    </button>
                                    <button
                                        type="button"
                                        class="admin-chip admin-chip--danger"
                                        data-delete-selected
                                    >
                                        Hapus terpilih
                                    </button>
                                </div>
                            </div>
                            <div class="admin-filter-grid">
                                <div class="admin-filter">
                                    <p class="admin-filter__label">Status</p>
                                    <div class="admin-filter__chips" role="group">
                                        <button
                                            type="button"
                                            class="admin-filter-chip is-active"
                                            data-filter-type="status"
                                            data-filter-value="all"
                                        >
                                            Semua
                                        </button>
                                        <button
                                            type="button"
                                            class="admin-filter-chip"
                                            data-filter-type="status"
                                            data-filter-value="unread"
                                        >
                                            Belum dibaca
                                        </button>
                                        <button
                                            type="button"
                                            class="admin-filter-chip"
                                            data-filter-type="status"
                                            data-filter-value="read"
                                        >
                                            Sudah dibaca
                                        </button>
                                    </div>
                                </div>
                                <div class="admin-filter">
                                    <p class="admin-filter__label">Jenis</p>
                                    <div class="admin-filter__chips" role="group">
                                        <button
                                            type="button"
                                            class="admin-filter-chip is-active"
                                            data-filter-type="type"
                                            data-filter-value="all"
                                        >
                                            Semua
                                        </button>
                                        <button
                                            type="button"
                                            class="admin-filter-chip"
                                            data-filter-type="type"
                                            data-filter-value="comment"
                                        >
                                            Komentar
                                        </button>
                                        <button
                                            type="button"
                                            class="admin-filter-chip"
                                            data-filter-type="type"
                                            data-filter-value="like"
                                        >
                                            Love
                                        </button>
                                        <button
                                            type="button"
                                            class="admin-filter-chip"
                                            data-filter-type="type"
                                            data-filter-value="message"
                                        >
                                            Pesan
                                        </button>
                                        <button
                                            type="button"
                                            class="admin-filter-chip"
                                            data-filter-type="type"
                                            data-filter-value="system"
                                        >
                                            Sistem
                                        </button>
                                    </div>
                                </div>
                                <div class="admin-filter">
                                    <p class="admin-filter__label">Prioritas</p>
                                    <div class="admin-filter__chips" role="group">
                                        <button
                                            type="button"
                                            class="admin-filter-chip is-active"
                                            data-filter-type="priority"
                                            data-filter-value="all"
                                        >
                                            Semua
                                        </button>
                                        <button
                                            type="button"
                                            class="admin-filter-chip"
                                            data-filter-type="priority"
                                            data-filter-value="high"
                                        >
                                            Tinggi
                                        </button>
                                        <button
                                            type="button"
                                            class="admin-filter-chip"
                                            data-filter-type="priority"
                                            data-filter-value="medium"
                                        >
                                            Sedang
                                        </button>
                                        <button
                                            type="button"
                                            class="admin-filter-chip"
                                            data-filter-type="priority"
                                            data-filter-value="low"
                                        >
                                            Rendah
                                        </button>
                                    </div>
                                </div>
                                <div class="admin-filter">
                                    <p class="admin-filter__label">Fokus</p>
                                    <div class="admin-filter__toggles">
                                        <label class="admin-toggle">
                                            <input
                                                type="checkbox"
                                                data-unread-toggle
                                            />
                                            <span class="admin-toggle__label">
                                                Hanya yang belum dibaca
                                            </span>
                                        </label>
                                        <label class="admin-toggle">
                                            <input type="checkbox" data-select-all />
                                            <span class="admin-toggle__label">
                                                Pilih semua terlihat
                                            </span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="admin-notifications__meta">
                                <p class="admin-notifications__meta-item" data-visible-count>
                                    Menampilkan {notifications.length} notifikasi
                                </p>
                                <p
                                    class="admin-notifications__meta-item"
                                    data-filter-summary
                                >
                                    Filter aktif: semua
                                </p>
                            </div>
                            <div class="admin-notifications__control-actions admin-notifications__control-actions--simple">
                                <button
                                    type="button"
                                    class="admin-chip admin-chip--ghost"
                                    data-reset-feed
                                >
                                    Segarkan daftar
                                </button>
                                <button
                                    type="button"
                                    class="admin-chip admin-chip--muted"
                                    data-delete-selected
                                >
                                    Hapus pilihan
                                </button>
                            </div>
                        </div>
                    </div>
                    <div
                        class="admin-notifications"
                        data-admin-notifications
                        data-supabase-ready={supabaseEnabled ? "true" : "false"}
                        data-supabase-url={supabaseEnabled ? supabaseUrl : undefined}
                        data-supabase-key={
                            supabaseEnabled ? supabaseAnonKey : undefined
                        }
                    >
                        {
                            notifications.map((item) => (
                                <article
                                    class="admin-notification"
                                    data-status={item.status}
                                    data-notification-item
                                >
                                    <div
                                        class="admin-notification__icon"
                                        data-type={item.type}
                                        aria-hidden="true"
                                    >
                                        <i
                                            class={`fa-solid ${
                                                item.type === "comment"
                                                    ? "fa-comment-dots"
                                                    : item.type === "like"
                                                      ? "fa-heart"
                                                      : item.type === "message"
                                                        ? "fa-inbox"
                                                        : "fa-bell"
                                            }`}
                                        />
                                    </div>
                                    <div class="admin-notification__content">
                                        <div class="admin-notification__top">
                                            <div class="admin-notification__titles">
                                                <p class="admin-notification__title">
                                                    {item.title}
                                                </p>
                                                <p class="admin-notification__meta">
                                                    {formatNotificationTime(item.time)}
                                                </p>
                                            </div>
                                            <div class="admin-notification__labels">
                                                <span
                                                    class="admin-notification__type"
                                                    data-type={item.type}
                                                >
                                                    {formatNotificationType(
                                                        item.type,
                                                    )}
                                                </span>
                                                {item.status === "unread" ? (
                                                    <span class="admin-pill-badge admin-pill-badge--new">
                                                        Baru
                                                    </span>
                                                ) : null}
                                            </div>
                                        </div>
                                        <p class="admin-notification__text">
                                            {item.message}
                                        </p>
                                        <div class="admin-notification__footer">
                                            <div class="admin-notification__status">
                                                <span
                                                    class="admin-dot"
                                                    aria-hidden="true"
                                                ></span>
                                                <span class="admin-notification__status-text">
                                                    {item.status === "unread"
                                                        ? "Menunggu aksi"
                                                        : "Sudah dilihat"}
                                                </span>
                                            </div>
                                            <div class="admin-notification__actions">
                                                {item.href ? (
                                                    <a
                                                        class="admin-link-button"
                                                        href={item.href}
                                                    >
                                                        Lihat
                                                        <i
                                                            class="fa-solid fa-arrow-right"
                                                            aria-hidden="true"
                                                        ></i>
                                                    </a>
                                                ) : null}
                                            </div>
                                        </div>
                                    </div>
                                </article>
                            ))
                        }
                    </div>
                    <script type="application/json" id="admin-notifications-data">
                        {JSON.stringify(notifications)}
                    </script>
                </div>
            </section>

            <section
                id="articles"
                class="tab-pane hidden"
                role="tabpanel"
                aria-labelledby="articles-tab"
            >
                <div class="admin-card">
                    <div class="admin-card__header">
                        <div>
                            <p class="admin-eyebrow">Artikel</p>
                            <h2>Daftar konten</h2>
                        </div>
                        <a
                            href="/admin/editor"
                            class="admin-chip admin-chip--primary no-underline"
                        >
                            <i class="fa-solid fa-plus"></i>
                            <span>Artikel</span>
                        </a>
                    </div>
                    <div class="admin-records" role="table">
                        {
                            articles.map((article) => (
                                <article class="admin-record" role="row">
                                    <div class="admin-record__main" role="cell">
                                        <p class="admin-record__title">
                                            {article.title}
                                        </p>
                                        <p class="admin-record__slug">
                                            {article.filename}
                                        </p>
                                    </div>
                                    <dl class="admin-record__meta" role="cell">
                                        <div>
                                            <dt>Tanggal</dt>
                                            <dd>
                                                {article.date
                                                    ? new Date(
                                                          article.date,
                                                      ).toLocaleDateString()
                                                    : "-"}
                                            </dd>
                                        </div>
                                        <div>
                                            <dt>Kata</dt>
                                            <dd>{article.words}</dd>
                                        </div>
                                        <div>
                                            <dt>Produk</dt>
                                            <dd>
                                                {article.affiliateProducts
                                                    ?.length ?? 0}
                                            </dd>
                                        </div>
                                    </dl>
                                    <div class="admin-row-actions" role="cell">
                                        <a
                                            href={`/blog/${article.filename.replace(".md", "")}`}
                                            target="_blank"
                                            class="icon-button"
                                            title="Lihat artikel"
                                        >
                                            <i class="fa-solid fa-eye" />
                                        </a>
                                        <a
                                            href={`/admin/editor?file=${article.filename}`}
                                            class="icon-button"
                                            title="Edit artikel"
                                        >
                                            <i class="fa-solid fa-pen-to-square" />
                                        </a>
                                        <button
                                            type="button"
                                            class="icon-button icon-button--danger delete-btn"
                                            data-filename={article.filename}
                                            title="Hapus artikel"
                                        >
                                            <i class="fa-solid fa-trash" />
                                        </button>
                                    </div>
                                </article>
                            ))
                        }
                    </div>
                </div>
            </section>

            <section
                id="products"
                class="tab-pane hidden"
                role="tabpanel"
                aria-labelledby="products-tab"
            >
                <div class="admin-card">
                    <div class="admin-card__header">
                        <div>
                            <p class="admin-eyebrow">Produk</p>
                            <h2>Daftar afiliasi</h2>
                        </div>
                        <a
                            href="/admin/add-product"
                            class="admin-chip admin-chip--primary no-underline"
                        >
                            <i class="fa-solid fa-plus"></i>
                            <span>Produk</span>
                        </a>
                    </div>
                    <div class="admin-records" role="table">
                        {
                            affiliateProducts.map((product) => (
                                <article
                                    class="admin-record admin-record--product"
                                    role="row"
                                >
                                    <div class="admin-record__main" role="cell">
                                        <div
                                            class="admin-product__media admin-product__media--compact"
                                            aria-hidden="true"
                                        >
                                            <img
                                                src={product.image}
                                                alt={product.name}
                                                loading="lazy"
                                            />
                                        </div>
                                        <div>
                                            <p class="admin-record__title">
                                                {product.name}
                                            </p>
                                            <p class="admin-record__slug">
                                                {product.id}
                                            </p>
                                        </div>
                                    </div>
                                    <dl class="admin-record__meta" role="cell">
                                        <div>
                                            <dt>Kategori</dt>
                                            <dd>{product.category ?? "-"}</dd>
                                        </div>
                                        <div>
                                            <dt>Harga</dt>
                                            <dd>
                                                {formatRupiah(product.price)}
                                            </dd>
                                        </div>
                                        {product.discount ? (
                                            <div>
                                                <dt>Diskon</dt>
                                                <dd>{product.discount}</dd>
                                            </div>
                                        ) : null}
                                    </dl>
                                    <div class="admin-row-actions" role="cell">
                                        <a
                                            href={`/admin/edit-product?id=${product.id}`}
                                            class="icon-button"
                                            title="Edit produk"
                                        >
                                            <i class="fa-solid fa-pen-to-square" />
                                        </a>
                                        <button
                                            type="button"
                                            class="icon-button icon-button--danger delete-product-btn"
                                            data-product-id={product.id}
                                            data-product-name={product.name}
                                            title="Hapus produk"
                                        >
                                            <i class="fa-solid fa-trash" />
                                        </button>
                                    </div>
                                </article>
                            ))
                        }
                    </div>
                </div>
            </section>

            <section
                id="analytics"
                class="tab-pane hidden"
                role="tabpanel"
                aria-labelledby="analytics-tab"
            >
                <div class="admin-panel admin-panel--stack">
                    <div class="admin-card">
                        <div class="admin-card__header">
                            <div>
                                <p class="admin-eyebrow">Analitik</p>
                                <h2>Performa konten</h2>
                            </div>
                        </div>
                        <div class="admin-metrics">
                            <div class="admin-metric">
                                <p>Total artikel</p>
                                <strong>{stats.totalArticles}</strong>
                            </div>
                            <div class="admin-metric">
                                <p>Total kata</p>
                                <strong
                                    >{stats.totalWords.toLocaleString()}</strong
                                >
                            </div>
                            <div class="admin-metric">
                                <p>Rata-rata kata / artikel</p>
                                <strong>{stats.averageWordsPerArticle}</strong>
                            </div>
                            <div class="admin-metric">
                                <p>Total waktu baca</p>
                                <strong>{stats.totalReadingTime} menit</strong>
                            </div>
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="admin-card__header">
                            <div>
                                <p class="admin-eyebrow">Insight</p>
                                <h2>Korelasi produk</h2>
                            </div>
                        </div>
                        <div class="admin-progress">
                            <div class="admin-progress__item">
                                <div class="admin-progress__label">
                                    <span>Artikel dengan produk</span>
                                    <strong
                                        >{articlesWithAffiliates.length}</strong
                                    >
                                </div>
                                <div class="admin-progress__track">
                                    <span
                                        class="admin-progress__value"
                                        style={`width: ${affiliateCoverage}%`}
                                    ></span>
                                </div>
                                <p class="admin-progress__meta">
                                    {affiliateCoverage}% dari konten sudah
                                    memiliki tautan afiliasi.
                                </p>
                            </div>
                            <div class="admin-progress__item">
                                <div class="admin-progress__label">
                                    <span>Produk rata-rata / artikel</span>
                                    <strong>{averageProductsPerArticle}</strong>
                                </div>
                                <div class="admin-progress__track">
                                    <span
                                        class="admin-progress__value"
                                        style={`width: ${Math.min(averageProductsPerArticle * 25, 100)}%`}
                                    ></span>
                                </div>
                                <p class="admin-progress__meta">
                                    Targetkan 2 produk / artikel untuk performa
                                    maksimal.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section
                id="settings"
                class="tab-pane hidden"
                role="tabpanel"
                aria-labelledby="settings-tab"
            >
                <div class="admin-panel admin-panel--stack">
                    <div class="admin-card">
                        <div class="admin-card__header">
                            <div>
                                <p class="admin-eyebrow">Konfigurasi</p>
                                <h2>Pengaturan situs</h2>
                            </div>
                        </div>
                        <div class="admin-setting-list">
                            <a
                                href="/admin/metadata"
                                class="admin-setting-action"
                            >
                                <div>
                                    <p>Metadata situs</p>
                                    <span>Edit judul, deskripsi, dan SEO.</span>
                                </div>
                                <i
                                    class="fa-solid fa-chevron-right"
                                    aria-hidden="true"></i>
                            </a>
                            <a
                                href="/admin/upload"
                                class="admin-setting-action"
                            >
                                <div>
                                    <p>Upload berkas</p>
                                    <span>Tambahkan aset pendukung konten.</span
                                    >
                                </div>
                                <i
                                    class="fa-solid fa-chevron-right"
                                    aria-hidden="true"></i>
                            </a>
                        </div>
                    </div>

                    <div class="admin-card">
                        <div class="admin-card__header">
                            <div>
                                <p class="admin-eyebrow">Aksi cepat</p>
                                <h2>Perawatan sistem</h2>
                            </div>
                        </div>
                        <div class="admin-setting-list">
                            <button
                                type="button"
                                onclick="exportData()"
                                class="admin-setting-action admin-setting-action--button"
                            >
                                <div>
                                    <p>Ekspor data</p>
                                    <span
                                        >Backup artikel, produk, dan
                                        konfigurasi.</span
                                    >
                                </div>
                                <i
                                    class="fa-solid fa-download"
                                    aria-hidden="true"></i>
                            </button>
                            <button
                                type="button"
                                onclick="clearCache()"
                                class="admin-setting-action admin-setting-action--button"
                            >
                                <div>
                                    <p>Bersihkan cache</p>
                                    <span
                                        >Segarkan data statis dan regenerasi
                                        konten.</span
                                    >
                                </div>
                                <i class="fa-solid fa-broom" aria-hidden="true"
                                ></i>
                            </button>
                            <form
                                action="/api/auth/logout"
                                method="POST"
                                class="w-full"
                            >
                                <button
                                    type="submit"
                                    class="admin-setting-action admin-setting-action--button text-red-600 dark:text-red-400"
                                >
                                    <div>
                                        <p>Keluar</p>
                                        <span>Akhiri sesi admin.</span>
                                    </div>
                                    <i
                                        class="fa-solid fa-right-from-bracket"
                                        aria-hidden="true"></i>
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <nav
        class="admin-bottom-nav"
        role="tablist"
        aria-label="Navigasi dashboard"
        style={`--nav-count: ${adminTabs.length}; --active-index: 0;`}
    >
        {
            adminTabs.map((tab, index) => (
                <button
                    type="button"
                    class={`admin-bottom-nav__item ${
                        tab.id === "overview" ? "active" : ""
                    }`}
                    data-tab={tab.id}
                    data-tab-trigger
                    data-index={index}
                    role="tab"
                    aria-selected={tab.id === "overview"}
                    aria-controls={tab.id}
                    title={tab.tooltip}
                >
                    <i class={`fa-solid ${tab.icon}`} aria-hidden="true" />
                </button>
            ))
        }
        <span class="admin-bottom-nav__indicator" aria-hidden="true"></span>
    </nav>

    <script>
        // Extend Window interface for TypeScript
        declare global {
            interface Window {
                showToast?: (
                    message: string,
                    options?: { type: "success" | "error" | "info" },
                ) => void;
            }
        }

        const TAB_TRIGGER_SELECTOR = "[data-tab-trigger]";
        const TAB_PANE_SELECTOR = ".tab-pane";

        const notificationContainer = document.querySelector<HTMLElement>(
            "[data-admin-notifications]",
        );
        const unreadBadge = document.querySelector<HTMLElement>(
            "[data-unread-count]",
        );
        const bellUnreadBadge = document.querySelector<HTMLElement>(
            "[data-unread-badge]",
        );
        const unreadSummaryCount = document.querySelector<HTMLElement>(
            "[data-unread-pill-count]",
        );
        const totalCountLabel = document.querySelector<HTMLElement>(
            "[data-total-count]",
        );
        const latestTimeLabel = document.querySelector<HTMLElement>(
            "[data-latest-time]",
        );
        const notificationTrigger = document.querySelector<HTMLElement>(
            "[data-notification-trigger]",
        );
        const selectAllCheckbox = document.querySelector<HTMLInputElement>(
            "[data-select-all]",
        );
        const markSelectedButton = document.querySelector<HTMLButtonElement>(
            "[data-mark-selected]",
        );
        const deleteSelectedButton = document.querySelector<HTMLButtonElement>(
            "[data-delete-selected]",
        );
        const markAllButton = document.querySelector<HTMLButtonElement>(
            "[data-mark-all]",
        );
        const resetFeedButton = document.querySelector<HTMLButtonElement>(
            "[data-reset-feed]",
        );
        const resetFiltersButton = document.querySelector<HTMLButtonElement>(
            "[data-reset-filters]",
        );
        const priorityCountLabel = document.querySelector<HTMLElement>(
            "[data-priority-count]",
        );
        const visibleCountLabel = document.querySelector<HTMLElement>(
            "[data-visible-count]",
        );
        const filterSummaryLabel = document.querySelector<HTMLElement>(
            "[data-filter-summary]",
        );
        const searchInput = document.querySelector<HTMLInputElement>(
            "[data-notification-search]",
        );
        const filterButtons = Array.from(
            document.querySelectorAll<HTMLButtonElement>("[data-filter-type]"),
        );
        const unreadToggle = document.querySelector<HTMLInputElement>(
            "[data-unread-toggle]",
        );
        const notificationsData = document.getElementById(
            "admin-notifications-data",
        ) as HTMLScriptElement | null;

        const parseJSON = (value: string | null) => {
            try {
                return value ? JSON.parse(value) : [];
            } catch (error) {
                console.warn("[Admin] Failed to parse notifications", error);
                return [];
            }
        };

        type AdminNotification = {
            id: string;
            type: "comment" | "like" | "message" | "system";
            title: string;
            message: string;
            time: string;
            status?: "unread" | "read";
            href?: string;
            priority?: "low" | "medium" | "high";
            category?: string;
            source?: string;
            tags?: string[];
        };

        const parsedNotifications = parseJSON(
            notificationsData?.textContent ?? "[]",
        );

        const initialNotifications: AdminNotification[] = Array.isArray(
            parsedNotifications,
        )
            ? parsedNotifications
            : [];

        const supabaseReady =
            notificationContainer?.dataset.supabaseReady === "true";
        const supabaseUrl =
            notificationContainer?.dataset.supabaseUrl?.replace(/\/+$/, "") ?? "";
        const supabaseKey = notificationContainer?.dataset.supabaseKey ?? "";

        let notificationState: AdminNotification[] = initialNotifications;
        const defaultNotifications = [...initialNotifications];
        let filteredNotifications: AdminNotification[] = initialNotifications;
        const selectedNotificationIds = new Set<string>();
        let supabaseClientPromise: Promise<any> | null = null;
        let notificationChannel: any = null;

        const filters = {
            status: "all" as "all" | "unread" | "read",
            type: "all" as AdminNotification["type"] | "all",
            priority: "all" as "all" | "low" | "medium" | "high",
            query: "",
            onlyUnread: false,
        };

        const supabaseHeaders = () => ({
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
        });

        const formatPriorityLabel = (value?: string) => {
            if (value === "high") return "Prioritas tinggi";
            if (value === "low") return "Prioritas rendah";
            return "Prioritas sedang";
        };

        const buildFilterSummary = () => {
            const parts: string[] = [];
            if (filters.query.trim()) parts.push(`kata kunci "${filters.query}"`);
            if (filters.status !== "all") parts.push(`status ${filters.status}`);
            if (filters.type !== "all")
                parts.push(`jenis ${formatNotificationTypeLabel(filters.type)}`);
            if (filters.priority !== "all")
                parts.push(formatPriorityLabel(filters.priority));
            if (filters.onlyUnread) parts.push("mode fokus belum dibaca");
            return parts.length ? parts.join(" • ") : "semua";
        };

        const formatRelativeTime = (value: string) => {
            const target = new Date(value);
            if (Number.isNaN(target.getTime())) return "Baru saja";
            const diffMs = Date.now() - target.getTime();
            const diffMinutes = Math.round(diffMs / 60000);
            if (diffMinutes < 1) return "Baru saja";
            if (diffMinutes < 60) return `${diffMinutes} menit lalu`;
            const diffHours = Math.round(diffMinutes / 60);
            if (diffHours < 24) return `${diffHours} jam lalu`;
            const diffDays = Math.round(diffHours / 24);
            return `${diffDays} hari lalu`;
        };

        const formatNotificationTypeLabel = (value: string) => {
            if (value === "comment") return "Komentar";
            if (value === "like") return "Love";
            if (value === "message") return "Pesan";
            return "Sistem";
        };

        const updateUnreadIndicators = (unreadCount: number) => {
            const summaryLabel =
                unreadCount === 0
                    ? "Tidak ada notif baru"
                    : `${unreadCount} notif`;

            if (unreadBadge) {
                unreadBadge.textContent = summaryLabel;
                if (unreadCount === 0) {
                    unreadBadge.setAttribute("data-empty", "true");
                } else {
                    unreadBadge.removeAttribute("data-empty");
                }
            }

            if (unreadSummaryCount) {
                unreadSummaryCount.textContent = summaryLabel;
            }

            if (bellUnreadBadge) {
                bellUnreadBadge.textContent = String(unreadCount);
                if (unreadCount === 0) {
                    bellUnreadBadge.setAttribute("hidden", "true");
                } else {
                    bellUnreadBadge.removeAttribute("hidden");
                }
            }

            if (notificationTrigger) {
                notificationTrigger.setAttribute(
                    "data-has-unread",
                    unreadCount > 0 ? "true" : "false",
                );
                notificationTrigger.setAttribute(
                    "aria-label",
                    `Lihat notifikasi (${summaryLabel})`,
                );
            }
        };

        const updateTotalCount = (total: number) => {
            if (totalCountLabel) {
                totalCountLabel.textContent = `${total} notifikasi`;
            }
        };

        const updatePriorityCount = (items: AdminNotification[]) => {
            const highPriority = items.filter(
                (item) => (item.priority ?? "medium") === "high",
            ).length;
            if (priorityCountLabel) {
                priorityCountLabel.textContent = `${highPriority} item`;
            }
        };

        const updateMetaSummary = (
            allItems: AdminNotification[],
            visibleItems: AdminNotification[],
        ) => {
            if (visibleCountLabel) {
                visibleCountLabel.textContent = `Menampilkan ${visibleItems.length} dari ${allItems.length} notifikasi`;
            }

            if (filterSummaryLabel) {
                filterSummaryLabel.textContent = `Filter aktif: ${buildFilterSummary()}`;
            }

            const latestItem = allItems.reduce<AdminNotification | null>(
                (latest, current) => {
                    if (!latest) return current;
                    return new Date(current.time).getTime() >
                        new Date(latest.time).getTime()
                        ? current
                        : latest;
                },
                null,
            );

            if (latestItem && latestTimeLabel) {
                latestTimeLabel.textContent = formatRelativeTime(latestItem.time);
            }
        };

        const applyFilters = (items: AdminNotification[]) => {
            const query = filters.query.trim().toLowerCase();
            const matchesQuery = (item: AdminNotification) => {
                if (!query) return true;
                const base = `${item.title} ${item.message} ${
                    item.category ?? ""
                } ${item.tags?.join(" ") ?? ""}`.toLowerCase();
                return base.includes(query);
            };

            return items.filter((item) => {
                if (filters.onlyUnread && (item.status ?? "unread") !== "unread")
                    return false;
                if (filters.status !== "all" && (item.status ?? "unread") !== filters.status)
                    return false;
                if (filters.type !== "all" && item.type !== filters.type) return false;
                if (
                    filters.priority !== "all" &&
                    (item.priority ?? "medium") !== filters.priority
                )
                    return false;
                return matchesQuery(item);
            });
        };

        const allItemsAreRead = () =>
            notificationState.every(
                (item) => (item.status ?? "unread") === "read",
            );

        const syncBulkControls = () => {
            const checkboxes = notificationContainer?.querySelectorAll<HTMLInputElement>(
                "[data-selection-checkbox]",
            );
            const visibleCheckboxes = Array.from(checkboxes ?? []);
            if (selectAllCheckbox) {
                const selectedVisible = visibleCheckboxes.filter((box) => box.checked);
                selectAllCheckbox.indeterminate =
                    selectedVisible.length > 0 &&
                    selectedVisible.length < visibleCheckboxes.length;
                selectAllCheckbox.checked =
                    visibleCheckboxes.length > 0 &&
                    selectedVisible.length === visibleCheckboxes.length;
            }

            const hasSelection = selectedNotificationIds.size > 0;
            markSelectedButton?.toggleAttribute("disabled", !hasSelection);
            deleteSelectedButton?.toggleAttribute("disabled", !hasSelection);
            markAllButton?.toggleAttribute("disabled", allItemsAreRead());
        };

        const refreshNotifications = (override?: AdminNotification[]) => {
            const base = override ?? notificationState;
            filteredNotifications = applyFilters(base);
            renderNotifications(filteredNotifications);
            const unreadCount = base.filter(
                (item) => (item.status ?? "unread") === "unread",
            ).length;
            updateUnreadIndicators(unreadCount);
            updateTotalCount(base.length);
            updatePriorityCount(base);
            updateMetaSummary(base, filteredNotifications);
            syncBulkControls();
        };

        const setNotificationState = (
            nextState: AdminNotification[],
        ): void => {
            notificationState = nextState;
            refreshNotifications();
        };

        const attachSwipeGestures = (
            article: HTMLElement,
            main: HTMLElement,
            actions: HTMLElement,
        ) => {
            let startX = 0;
            let currentX = 0;
            let isDragging = false;
            let isOpen = false;

            const actionWidth = () =>
                Math.min(
                    Math.max(actions.offsetWidth || 160, 140),
                    240,
                );

            const resetTransition = () => {
                main.style.transition = "transform 180ms ease";
            };

            const clearTransition = () => {
                main.style.transition = "none";
            };

            const closePanel = () => {
                resetTransition();
                main.style.transform = "translateX(0)";
                isOpen = false;
            };

            const openPanel = () => {
                resetTransition();
                main.style.transform = `translateX(-${actionWidth()}px)`;
                isOpen = true;
            };

            const handlePointerDown = (event: PointerEvent) => {
                isDragging = true;
                startX = event.clientX;
                currentX = 0;
                clearTransition();
                main.setPointerCapture(event.pointerId);
            };

            const handlePointerMove = (event: PointerEvent) => {
                if (!isDragging) return;
                currentX = event.clientX - startX;
                const limit = actionWidth();
                const offset = Math.max(-limit, Math.min(0, currentX));
                main.style.transform = `translateX(${offset}px)`;
                if (Math.abs(currentX) > 4) {
                    event.preventDefault();
                }
            };

            const handlePointerUp = (event: PointerEvent) => {
                if (!isDragging) return;
                isDragging = false;
                main.releasePointerCapture(event.pointerId);
                const limit = actionWidth();
                const shouldOpen = currentX < -limit * 0.35;
                const shouldClose = currentX > -10;
                if (shouldClose) {
                    closePanel();
                    return;
                }
                if (shouldOpen || isOpen) {
                    openPanel();
                } else {
                    closePanel();
                }
            };

            main.addEventListener("pointerdown", handlePointerDown);
            main.addEventListener("pointermove", handlePointerMove);
            main.addEventListener("pointerup", handlePointerUp);
            main.addEventListener("pointercancel", handlePointerUp);
            article.addEventListener("mouseleave", () => {
                if (!isDragging && isOpen) closePanel();
            });
            main.addEventListener("click", () => {
                if (isOpen) {
                    closePanel();
                }
            });
        };

        const renderNotifications = (items: AdminNotification[]) => {
            if (!notificationContainer) return;
            notificationContainer.innerHTML = "";

            if (!items.length) {
                notificationContainer.innerHTML = `
                    <div class="admin-empty-state admin-empty-state--inline">
                        <p>Tidak ada notifikasi untuk filter yang dipilih.</p>
                        <p class="admin-empty-state__hint">
                            Coba reset filter atau tunggu update baru.
                        </p>
                    </div>
                `;
                return;
            }

            items.forEach((item) => {
                const article = document.createElement("article");
                article.className = "admin-notification";
                article.dataset.status = item.status ?? "unread";
                article.dataset.type = item.type;
                article.dataset.priority = item.priority ?? "medium";
                article.classList.toggle(
                    "is-new",
                    (item.status ?? "unread") === "unread",
                );

                const swipeWrapper = document.createElement("div");
                swipeWrapper.className = "admin-notification__swipe";

                const actionsPanel = document.createElement("div");
                actionsPanel.className = "admin-notification__swipe-actions";

                const markButton = document.createElement("button");
                markButton.type = "button";
                markButton.className = "admin-notification__swipe-button";
                markButton.dataset.variant = "mark";
                const nextStatus =
                    (item.status ?? "unread") === "unread"
                        ? "read"
                        : "unread";
                markButton.textContent =
                    nextStatus === "read"
                        ? "Tandai dibaca"
                        : "Tandai belum dibaca";
                markButton.addEventListener("click", (event) => {
                    event.stopPropagation();
                    const updated = notificationState.map((notif) =>
                        notif.id === item.id
                            ? { ...notif, status: nextStatus }
                            : notif,
                    );
                    setNotificationState(updated);
                });

                const deleteButton = document.createElement("button");
                deleteButton.type = "button";
                deleteButton.className =
                    "admin-notification__swipe-button admin-notification__swipe-button--danger";
                deleteButton.textContent = "Hapus";
                deleteButton.addEventListener("click", (event) => {
                    event.stopPropagation();
                    const remaining = notificationState.filter(
                        (notif) => notif.id !== item.id,
                    );
                    setNotificationState(remaining);
                });

                actionsPanel.appendChild(markButton);
                actionsPanel.appendChild(deleteButton);

                const main = document.createElement("div");
                main.className = "admin-notification__main";

                const selection = document.createElement("div");
                selection.className = "admin-notification__select";
                const checkbox = document.createElement("input");
                checkbox.type = "checkbox";
                checkbox.setAttribute("aria-label", "Pilih notifikasi");
                checkbox.dataset.selectionCheckbox = "true";
                checkbox.dataset.id = item.id;
                checkbox.checked = selectedNotificationIds.has(item.id);
                checkbox.addEventListener("change", () => {
                    if (checkbox.checked) {
                        selectedNotificationIds.add(item.id);
                    } else {
                        selectedNotificationIds.delete(item.id);
                    }
                    syncBulkControls();
                });
                selection.appendChild(checkbox);

                const icon = document.createElement("div");
                icon.className = "admin-notification__icon";
                icon.dataset.type = item.type;
                icon.setAttribute("aria-hidden", "true");

                const iconClass =
                    item.type === "comment"
                        ? "fa-comment-dots"
                        : item.type === "like"
                          ? "fa-heart"
                          : item.type === "message"
                            ? "fa-inbox"
                            : "fa-bell";
                icon.innerHTML = `<i class="fa-solid ${iconClass}"></i>`;

                const content = document.createElement("div");
                content.className = "admin-notification__content";

                const top = document.createElement("div");
                top.className = "admin-notification__top";

                const titles = document.createElement("div");
                titles.className = "admin-notification__titles";

                const title = document.createElement("p");
                title.className = "admin-notification__title";
                title.textContent = item.title;

                const meta = document.createElement("p");
                meta.className = "admin-notification__meta";
                meta.textContent = formatRelativeTime(item.time);

                titles.appendChild(title);
                titles.appendChild(meta);

                const labels = document.createElement("div");
                labels.className = "admin-notification__labels";

                const typeBadge = document.createElement("span");
                typeBadge.className = "admin-notification__type";
                typeBadge.dataset.type = item.type;
                typeBadge.textContent = formatNotificationTypeLabel(item.type);
                labels.appendChild(typeBadge);

                const priority = document.createElement("span");
                priority.className = "admin-notification__priority";
                priority.dataset.priority = item.priority ?? "medium";
                priority.textContent = formatPriorityLabel(item.priority);
                labels.appendChild(priority);

                if ((item.status ?? "unread") === "unread") {
                    const badge = document.createElement("span");
                    badge.className = "admin-pill-badge admin-pill-badge--new";
                    badge.textContent = "Baru";
                    labels.appendChild(badge);
                }

                if (item.category) {
                    const category = document.createElement("span");
                    category.className = "admin-notification__category";
                    category.textContent = item.category;
                    labels.appendChild(category);
                }

                top.appendChild(titles);
                top.appendChild(labels);

                const text = document.createElement("p");
                text.className = "admin-notification__text";
                text.textContent = item.message;

                if (item.tags?.length) {
                    const tags = document.createElement("div");
                    tags.className = "admin-notification__tags";
                    item.tags.slice(0, 3).forEach((tag) => {
                        const pill = document.createElement("span");
                        pill.className = "admin-notification__tag";
                        pill.textContent = tag;
                        tags.appendChild(pill);
                    });
                    text.appendChild(tags);
                }

                const footer = document.createElement("div");
                footer.className = "admin-notification__footer";

                const status = document.createElement("div");
                status.className = "admin-notification__status";

                const dot = document.createElement("span");
                dot.className = "admin-dot";
                dot.setAttribute("aria-hidden", "true");
                status.appendChild(dot);

                const statusText = document.createElement("span");
                statusText.className = "admin-notification__status-text";
                statusText.textContent =
                    (item.status ?? "unread") === "unread"
                        ? "Menunggu aksi"
                        : "Sudah dilihat";
                status.appendChild(statusText);

                const actions = document.createElement("div");
                actions.className = "admin-notification__actions";
                if (item.href) {
                    const link = document.createElement("a");
                    link.className = "admin-link-button";
                    link.href = item.href;
                    link.innerHTML =
                        'Lihat <i class="fa-solid fa-arrow-right" aria-hidden="true"></i>';
                    actions.appendChild(link);
                }

                footer.appendChild(status);
                footer.appendChild(actions);

                content.appendChild(top);
                content.appendChild(text);
                content.appendChild(footer);

                const metaBar = document.createElement("div");
                metaBar.className = "admin-notification__meta-bar";
                metaBar.innerHTML = `<span><i class="fa-solid fa-clock" aria-hidden="true"></i> ${formatRelativeTime(
                    item.time,
                )}</span><span><i class="fa-solid fa-wave-square" aria-hidden="true"></i> ${
                    item.source ?? "Manual"
                }</span>`;

                content.appendChild(metaBar);

                main.appendChild(selection);
                main.appendChild(icon);
                main.appendChild(content);

                swipeWrapper.appendChild(actionsPanel);
                swipeWrapper.appendChild(main);

                article.appendChild(swipeWrapper);
                notificationContainer.appendChild(article);

                attachSwipeGestures(article, main, actionsPanel);
            });
            syncBulkControls();
        };

        const toggleSelectAll = (checked: boolean) => {
            const checkboxes = notificationContainer?.querySelectorAll<HTMLInputElement>(
                "[data-selection-checkbox]",
            );
            checkboxes?.forEach((box) => {
                const id = box.dataset.id;
                box.checked = checked;
                if (checked) {
                    if (id) selectedNotificationIds.add(id);
                } else if (id) {
                    selectedNotificationIds.delete(id);
                }
            });
            if (!checked) selectedNotificationIds.clear();
            syncBulkControls();
        };

        const markSelectedAsRead = () => {
            if (!selectedNotificationIds.size) return;
            const updated = notificationState.map((item) =>
                selectedNotificationIds.has(item.id)
                    ? { ...item, status: "read" as const }
                    : item,
            );
            selectedNotificationIds.clear();
            setNotificationState(updated);
        };

        const deleteSelected = () => {
            if (!selectedNotificationIds.size) return;
            notificationState = notificationState.filter(
                (item) => !selectedNotificationIds.has(item.id),
            );
            selectedNotificationIds.clear();
            refreshNotifications();
        };

        const markAllAsRead = () => {
            if (allItemsAreRead()) return;
            const updated = notificationState.map((item) => ({
                ...item,
                status: "read" as const,
            }));
            selectedNotificationIds.clear();
            setNotificationState(updated);
        };

        const updateFilterChips = () => {
            filterButtons.forEach((button) => {
                const type = button.dataset.filterType as
                    | "status"
                    | "type"
                    | "priority";
                const value = (button.dataset.filterValue ?? "all") as string;
                const isActive = (filters as any)[type] === value;
                button.classList.toggle("is-active", isActive);
            });
        };

        const setFilter = (
            type: "status" | "type" | "priority",
            value: string,
        ) => {
            (filters as any)[type] = value;
            updateFilterChips();
            refreshNotifications();
        };

        const resetFilters = () => {
            filters.status = "all";
            filters.type = "all";
            filters.priority = "all";
            filters.query = "";
            filters.onlyUnread = false;
            if (searchInput) searchInput.value = "";
            if (unreadToggle) unreadToggle.checked = false;
            selectedNotificationIds.clear();
            notificationContainer
                ?.querySelectorAll<HTMLInputElement>("[data-selection-checkbox]")
                .forEach((checkbox) => {
                    checkbox.checked = false;
                });
            updateFilterChips();
            refreshNotifications();
        };

        const resetFeed = () => {
            notificationState = [...defaultNotifications];
            selectedNotificationIds.clear();
            resetFilters();
            refreshNotifications(defaultNotifications);
        };

        const normalizeCommentNotification = (record: any) => {
            if (!record) return null;
            const slug = String(record.slug ?? "").replace(/^\/+|\/+$/g, "");
            return {
                id: `comment-${record.id ?? record.created_at}`,
                type: "comment",
                title: "Komentar baru",
                message: `${record.name || "Anonim"} mengomentari ${
                    slug || "artikel"
                }.`,
                time: record.created_at ?? new Date().toISOString(),
                status: "unread" as const,
                href: slug ? `/blog/${slug}` : undefined,
                priority: "high" as const,
                category: "Engagement",
                source: "supabase",
                tags: ["komentar", slug || "artikel"],
            } satisfies AdminNotification;
        };

        const normalizeLikeNotification = (record: any) => {
            if (!record) return null;
            const slug = String(record.slug ?? "").replace(/^\/+|\/+$/g, "");
            return {
                id: `like-${record.id ?? record.created_at}`,
                type: "like",
                title: "Love baru",
                message: `Artikel ${slug || "ini"} menerima love baru.`,
                time: record.created_at ?? new Date().toISOString(),
                status: "unread" as const,
                href: slug ? `/blog/${slug}` : undefined,
                priority: "medium" as const,
                category: "Engagement",
                source: "supabase",
                tags: ["love", slug || "artikel"],
            } satisfies AdminNotification;
        };

        const fetchRecentNotifications = async () => {
            if (!supabaseReady || !supabaseUrl || !supabaseKey) return [];
            const params = new URLSearchParams({
                select: "id,name,message,slug,created_at", // comments
                order: "created_at.desc",
                limit: "5",
            });
            const likeParams = new URLSearchParams({
                select: "id,slug,created_at",
                order: "created_at.desc",
                limit: "5",
            });

            const [commentsRes, likesRes] = await Promise.all([
                fetch(
                    `${supabaseUrl}/rest/v1/article_comments?${params.toString()}`,
                    { headers: supabaseHeaders() },
                ),
                fetch(
                    `${supabaseUrl}/rest/v1/article_likes?${likeParams.toString()}`,
                    { headers: supabaseHeaders() },
                ),
            ]);

            if (!commentsRes.ok || !likesRes.ok) {
                throw new Error("Gagal memuat data notifikasi Supabase");
            }

            const [comments, likes] = await Promise.all([
                commentsRes.json(),
                likesRes.json(),
            ]);

            const items: AdminNotification[] = [];
            if (Array.isArray(comments)) {
                comments
                    .map((item) => normalizeCommentNotification(item))
                    .filter(Boolean)
                    .forEach((item) => items.push(item as AdminNotification));
            }
            if (Array.isArray(likes)) {
                likes
                    .map((item) => normalizeLikeNotification(item))
                    .filter(Boolean)
                    .forEach((item) => items.push(item as AdminNotification));
            }

            return items.sort((a, b) =>
                new Date(b.time).getTime() - new Date(a.time).getTime(),
            );
        };

        const loadSupabaseClient = async () => {
            if (!supabaseReady || !supabaseUrl || !supabaseKey) return null;
            if (!supabaseClientPromise) {
                supabaseClientPromise = import(
                    "https://esm.sh/@supabase/supabase-js@2.45.2"
                ).then(({ createClient }) =>
                    createClient(supabaseUrl, supabaseKey, {
                        auth: { persistSession: false },
                    }),
                );
            }
            return supabaseClientPromise;
        };

        const subscribeRealtimeNotifications = async () => {
            if (!supabaseReady || notificationChannel) return;
            const client = await loadSupabaseClient();
            if (!client) return;

            notificationChannel = client.channel("admin-notifications");

            notificationChannel.on(
                "postgres_changes",
                {
                    event: "INSERT",
                    schema: "public",
                    table: "article_comments",
                },
                (payload: any) => {
                    const normalized = normalizeCommentNotification(payload.new);
                    if (!normalized) return;
                    const exists = notificationState.some(
                        (item) => item.id === normalized.id,
                    );
                    if (!exists) {
                        notificationState = [
                            normalized,
                            ...notificationState,
                        ].slice(0, 15);
                        refreshNotifications(notificationState);
                    }
                },
            );

            notificationChannel.on(
                "postgres_changes",
                {
                    event: "INSERT",
                    schema: "public",
                    table: "article_likes",
                },
                (payload: any) => {
                    const normalized = normalizeLikeNotification(payload.new);
                    if (!normalized) return;
                    const exists = notificationState.some(
                        (item) => item.id === normalized.id,
                    );
                    if (!exists) {
                        notificationState = [
                            normalized,
                            ...notificationState,
                        ].slice(0, 15);
                        refreshNotifications(notificationState);
                    }
                },
            );

            notificationChannel.subscribe();
        };

        const bootstrapNotifications = async () => {
            if (!notificationContainer) return;
            refreshNotifications();
            if (!supabaseReady) return;
            try {
                const items = await fetchRecentNotifications();
                if (items.length) {
                    notificationState = items.slice(0, 15);
                    refreshNotifications(notificationState);
                }
            } catch (error) {
                console.warn("[Admin] Notifikasi Supabase gagal dimuat", error);
            }
            subscribeRealtimeNotifications();
        };

        selectAllCheckbox?.addEventListener("change", (event) => {
            const target = event.target as HTMLInputElement;
            toggleSelectAll(target.checked);
        });

        markSelectedButton?.addEventListener("click", () => {
            markSelectedAsRead();
        });

        deleteSelectedButton?.addEventListener("click", () => {
            deleteSelected();
        });

        markAllButton?.addEventListener("click", () => {
            markAllAsRead();
        });

        resetFeedButton?.addEventListener("click", () => {
            resetFeed();
        });

        resetFiltersButton?.addEventListener("click", () => {
            resetFilters();
        });

        filterButtons.forEach((button) => {
            button.addEventListener("click", () => {
                const type = button.dataset.filterType as
                    | "status"
                    | "type"
                    | "priority";
                const value = button.dataset.filterValue ?? "all";
                setFilter(type, value);
            });
        });

        searchInput?.addEventListener("input", (event) => {
            const target = event.target as HTMLInputElement;
            filters.query = target.value;
            refreshNotifications();
        });

        unreadToggle?.addEventListener("change", (event) => {
            const target = event.target as HTMLInputElement;
            filters.onlyUnread = target.checked;
            refreshNotifications();
        });

        function setActiveTab(tabName: string): void {
            document.querySelectorAll(TAB_PANE_SELECTOR).forEach((pane) => {
                pane.classList.add("hidden");
                pane.classList.remove("active");
            });

            const selectedPane = document.getElementById(tabName);
            if (selectedPane) {
                selectedPane.classList.remove("hidden");
                selectedPane.classList.add("active");
            }

            document.querySelectorAll(TAB_TRIGGER_SELECTOR).forEach((btn) => {
                const button = btn as HTMLButtonElement;
                const isTarget = button.getAttribute("data-tab") === tabName;
                button.classList.toggle("active", isTarget);
                if (button.hasAttribute("aria-selected")) {
                    button.setAttribute(
                        "aria-selected",
                        isTarget ? "true" : "false",
                    );
                }
            });

            updateBottomNavIndicator(tabName);
        }

        function updateBottomNavIndicator(tabName: string): void {
            const bottomNav = document.querySelector(
                ".admin-bottom-nav",
            ) as HTMLElement | null;
            if (!bottomNav) return;

            const triggers =
                bottomNav.querySelectorAll<HTMLElement>("[data-tab-trigger]");

            let activeIndex = 0;
            triggers.forEach((trigger, index) => {
                if (trigger.getAttribute("data-tab") === tabName) {
                    activeIndex = index;
                }
            });

            bottomNav.style.setProperty("--active-index", String(activeIndex));
        }

        function switchTab(tabName: string): void {
            setActiveTab(tabName);
        }

        document.querySelectorAll(TAB_TRIGGER_SELECTOR).forEach((btn) => {
            btn.addEventListener("click", () => {
                const tabName = btn.getAttribute("data-tab");
                if (tabName) {
                    switchTab(tabName);
                    window.scrollTo({ top: 0, behavior: "smooth" });
                }
            });
        });

        function initializeTabs(): void {
            setActiveTab("overview");
            updateFilterChips();
            bootstrapNotifications();
        }

        // Hide bottom nav when approaching footer
        function handleBottomNavVisibility(): void {
            const bottomNav = document.querySelector(
                ".admin-bottom-nav",
            ) as HTMLElement | null;
            if (!bottomNav) return;

            const scrollPosition = window.scrollY + window.innerHeight;
            const documentHeight = document.documentElement.scrollHeight;
            const threshold = 200; // Hide when within 200px of bottom

            if (scrollPosition >= documentHeight - threshold) {
                bottomNav.style.opacity = "0";
                bottomNav.style.pointerEvents = "none";
            } else {
                bottomNav.style.opacity = "1";
                bottomNav.style.pointerEvents = "auto";
            }
        }

        // Throttle scroll events for performance
        let scrollTimeout: number;
        window.addEventListener("scroll", () => {
            if (scrollTimeout) {
                window.cancelAnimationFrame(scrollTimeout);
            }
            scrollTimeout = window.requestAnimationFrame(
                handleBottomNavVisibility,
            );
        });

        if (document.readyState === "loading") {
            document.addEventListener("DOMContentLoaded", initializeTabs);
        } else {
            initializeTabs();
        }

        // Utility functions
        function exportData(): void {
            if (
                confirm("Export all site data? This will create a backup file.")
            ) {
                // Implement export functionality
                console.log("Exporting data...");
                if (typeof window.showToast === "function") {
                    window.showToast("Data export initiated!", {
                        type: "success",
                    });
                }
            }
        }

        function clearCache(): void {
            if (
                confirm(
                    "Clear all cached data? This may temporarily slow down the site.",
                )
            ) {
                // Implement cache clearing
                if (typeof window.showToast === "function") {
                    window.showToast("Cache cleared successfully!", {
                        type: "success",
                    });
                }
                setTimeout(() => window.location.reload(), 500);
            }
        }

        // Handle delete button clicks (copied from original admin page)
        document.querySelectorAll(".delete-btn").forEach((btn) => {
            btn.addEventListener("click", async () => {
                const button = btn as HTMLButtonElement;
                const filename = button.dataset.filename;

                if (
                    !filename ||
                    !confirm(
                        `Are you sure you want to delete "${filename}"? This action cannot be undone.`,
                    )
                ) {
                    return;
                }

                try {
                    button.disabled = true;
                    button.innerHTML =
                        '<i class="fa-solid fa-spinner fa-spin"></i>';

                    const response = await fetch("/api/admin/delete", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ filename }),
                    });

                    const result = await response.json();

                    if (response.ok) {
                        if (typeof window.showToast === "function") {
                            window.showToast("Article deleted successfully!", {
                                type: "success",
                            });
                        }
                        setTimeout(() => window.location.reload(), 1200);
                    } else {
                        if (typeof window.showToast === "function") {
                            window.showToast("Error: " + result.error, {
                                type: "error",
                            });
                        } else {
                            alert("Error deleting file: " + result.error);
                        }
                        button.disabled = false;
                        button.innerHTML = '<i class="fa-solid fa-trash"></i>';
                    }
                } catch (error) {
                    console.error(error);
                    if (typeof window.showToast === "function") {
                        window.showToast("Failed to delete article", {
                            type: "error",
                        });
                    } else {
                        alert("Error deleting file");
                    }
                    button.disabled = false;
                    button.innerHTML = '<i class="fa-solid fa-trash"></i>';
                }
            });
        });

        document.querySelectorAll(".delete-product-btn").forEach((btn) => {
            btn.addEventListener("click", async () => {
                const button = btn as HTMLButtonElement;
                const productId = button.dataset.productId;
                const productName = button.dataset.productName || productId;

                if (
                    !productId ||
                    !confirm(
                        `Hapus produk "${productName}"? Tindakan ini tidak bisa dibatalkan.`,
                    )
                ) {
                    return;
                }

                try {
                    button.disabled = true;
                    button.innerHTML =
                        '<i class="fa-solid fa-spinner fa-spin"></i>';

                    const response = await fetch("/api/admin/delete-product", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({ id: productId }),
                    });

                    const result = await response.json();

                    if (response.ok) {
                        if (typeof window.showToast === "function") {
                            window.showToast("Produk berhasil dihapus", {
                                type: "success",
                            });
                        }
                        setTimeout(() => window.location.reload(), 1200);
                    } else {
                        if (typeof window.showToast === "function") {
                            window.showToast(
                                result.error || "Gagal menghapus",
                                {
                                    type: "error",
                                },
                            );
                        } else {
                            alert(result.error || "Gagal menghapus produk");
                        }
                        button.disabled = false;
                        button.innerHTML = '<i class="fa-solid fa-trash"></i>';
                    }
                } catch (error) {
                    console.error(error);
                    if (typeof window.showToast === "function") {
                        window.showToast("Terjadi kesalahan saat hapus", {
                            type: "error",
                        });
                    } else {
                        alert("Error deleting product");
                    }
                    button.disabled = false;
                    button.innerHTML = '<i class="fa-solid fa-trash"></i>';
                }
            });
        });
    </script>
</Layout>

<style>
    .admin-shell {
        max-width: 1000px;
        margin: 0 auto;
        padding: 1rem 1rem 4.5rem;
        --admin-font-xs: clamp(0.65rem, 1vw, 0.75rem);
        --admin-font-sm: clamp(0.75rem, 1.2vw, 0.85rem);
        --admin-font-base: clamp(0.85rem, 1.35vw, 0.95rem);
        --admin-font-lg: clamp(1rem, 1.6vw, 1.2rem);
        --admin-radius: 0.85rem;
        --admin-border: 1px solid
            color-mix(in srgb, var(--color-foreground) 12%, transparent);
        --admin-dashed-border: 1px dashed
            color-mix(in srgb, var(--color-foreground) 18%, transparent);
        --admin-card-padding: 0.95rem;
    }

    @media (max-width: 640px) {
        .admin-shell {
            padding: 0.75rem 0.75rem 5.25rem;
        }
    }

    .admin-header {
        display: flex;
        flex-direction: column;
        gap: 0.85rem;
        padding: var(--admin-card-padding);
        border-radius: var(--admin-radius);
        background: color-mix(in srgb, var(--color-card) 92%, transparent);
        border: var(--admin-border);
    }

    @media (min-width: 768px) {
        .admin-header {
            flex-direction: row;
            align-items: center;
            justify-content: space-between;
        }
    }

    .admin-title {
        font-family: var(--font-display);
        font-size: clamp(1.15rem, 2vw, 1.45rem);
        letter-spacing: 0.04em;
        margin: 0;
        text-transform: uppercase;
    }

    .admin-subtitle {
        font-size: var(--admin-font-sm);
        max-width: 45ch;
        color: color-mix(in srgb, var(--color-foreground) 70%, transparent);
        font-family: var(--font-serif);
        margin: 0.25rem 0 0;
        line-height: 1.3;
    }

    .admin-header__actions {
        display: flex;
        align-items: center;
        gap: 0.6rem;
        justify-content: flex-end;
        flex-wrap: wrap;
    }

    .admin-notification-button {
        position: relative;
        color: inherit;
    }

    .admin-notification-button:hover,
    .admin-notification-button:focus-visible {
        color: var(--color-primary);
    }

    .admin-notification-button[data-has-unread="true"] .fa-bell {
        animation: bell-ring 1.4s ease-in-out infinite;
        transform-origin: top center;
    }

    .admin-notification-badge {
        position: absolute;
        top: -0.4rem;
        right: -0.35rem;
        min-width: 1.25rem;
        height: 1.25rem;
        padding: 0 0.25rem;
        border-radius: 999px;
        background: var(--color-primary);
        color: var(--color-background);
        font-size: var(--admin-font-xs);
        display: inline-flex;
        align-items: center;
        justify-content: center;
        border: 1px solid
            color-mix(in srgb, var(--color-background) 75%, transparent);
    }

    .admin-notification-button[data-has-unread="true"] .admin-notification-badge::after {
        content: "";
        position: absolute;
        inset: -0.25rem;
        border-radius: 999px;
        border: 2px solid color-mix(in srgb, var(--color-primary) 60%, transparent);
        animation: pulse-ring 1.9s ease-out infinite;
        opacity: 0.8;
    }

    .admin-chip {
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
        border-radius: 999px;
        font-size: var(--admin-font-sm);
        font-weight: 600;
        padding: 0.35rem 0.85rem;
        border: var(--admin-border);
        transition:
            transform 150ms ease,
            border-color 150ms ease,
            background-color 150ms ease;
    }

    .admin-chip i {
        font-size: 0.85rem;
    }

    .admin-chip--primary {
        background: var(--color-foreground);
        color: var(--color-background);
        border-color: var(--color-foreground);
    }

    .admin-chip--muted {
        background: color-mix(in srgb, var(--color-foreground) 7%, transparent);
        color: var(--color-foreground);
    }

    .admin-chip--ghost {
        background: transparent;
        color: color-mix(in srgb, var(--color-foreground) 85%, transparent);
    }

    .admin-chip--danger {
        background: color-mix(in srgb, #ff6b6b 16%, transparent);
        color: color-mix(in srgb, #ff6b6b 90%, transparent);
        border-color: color-mix(in srgb, #ff6b6b 35%, transparent);
    }

    .admin-chip:hover,
    .admin-chip:focus-visible {
        transform: translateY(-1px);
    }

    .admin-quick-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.45rem;
    }

    .admin-quick-action-icon {
        width: 2.35rem;
        height: 2.35rem;
        border-radius: 0.7rem;
        display: grid;
        place-items: center;
        text-decoration: none;
        color: inherit;
        transition: all 150ms ease;
        border: 1px solid
            color-mix(in srgb, var(--color-foreground) 15%, transparent);
    }

    .admin-quick-action-icon[data-accent="primary"] {
        background: color-mix(in srgb, var(--color-primary) 15%, transparent);
        color: var(--color-primary);
        border-color: color-mix(in srgb, var(--color-primary) 35%, transparent);
    }

    .admin-quick-action-icon[data-accent="muted"] {
        background: color-mix(in srgb, var(--color-foreground) 8%, transparent);
        color: color-mix(in srgb, var(--color-foreground) 80%, transparent);
    }

    .admin-quick-action-icon:hover,
    .admin-quick-action-icon:focus-visible {
        transform: translateY(-1px);
        box-shadow: 0 3px 8px
            color-mix(in srgb, var(--color-foreground) 12%, transparent);
    }

    .admin-bottom-nav {
        position: fixed;
        bottom: 0.65rem;
        left: 50%;
        transform: translateX(-50%);
        width: min(480px, calc(100% - 1.5rem));
        padding: 0.35rem;
        border-radius: var(--admin-radius);
        background: color-mix(
            in srgb,
            var(--color-background) 96%,
            rgba(0, 0, 0, 0.3)
        );
        border: var(--admin-border);
        backdrop-filter: blur(18px);
        display: grid;
        grid-template-columns: repeat(5, 1fr);
        gap: 0.2rem;
        z-index: 25;
        transition: opacity 300ms ease;
    }

    .admin-bottom-nav__item {
        border: none;
        border-radius: 0.75rem;
        background: transparent;
        color: color-mix(in srgb, var(--color-foreground) 70%, transparent);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0.6rem;
        aspect-ratio: 1;
        transition: all 150ms ease;
        position: relative;
        overflow: hidden;
    }

    .admin-bottom-nav__item::before {
        content: "";
        position: absolute;
        inset: 0;
        background: transparent;
        border-radius: inherit;
        transition: all 150ms ease;
    }

    .admin-bottom-nav__item:hover::before {
        background: color-mix(in srgb, var(--color-foreground) 8%, transparent);
    }

    .admin-bottom-nav__item i {
        font-size: 1rem;
        position: relative;
        z-index: 1;
    }

    .admin-bottom-nav__item.active {
        color: var(--color-primary);
        background: color-mix(in srgb, var(--color-primary) 12%, transparent);
    }

    .admin-bottom-nav__item.active::before {
        background: color-mix(in srgb, var(--color-primary) 15%, transparent);
        box-shadow: inset 0 0 0 1px
            color-mix(in srgb, var(--color-primary) 35%, transparent);
    }

    .admin-bottom-nav__indicator {
        position: absolute;
        bottom: 0.2rem;
        left: 0.35rem;
        height: 2px;
        width: calc((100% - 0.7rem) / var(--nav-count, 5));
        border-radius: 999px;
        background: var(--color-primary);
        transform: translateX(
            calc(var(--active-index, 0) * (100% - 0.7rem) / var(--nav-count, 5))
        );
        transition: transform 220ms ease;
        pointer-events: none;
    }

    @media (min-width: 1024px) {
        .admin-bottom-nav {
            bottom: 1rem;
            width: min(400px, calc(100% - 3rem));
        }
    }

    .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
    }

    .tab-content {
        margin-top: 1.5rem;
    }

    .tab-pane {
        display: none;
        flex-direction: column;
        gap: 1rem;
    }

    .tab-pane.active {
        display: flex;
    }

    .admin-panel {
        display: flex;
        flex-direction: column;
        gap: 0.85rem;
    }

    .admin-panel--grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 0.65rem;
    }

    .admin-panel--split {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
        gap: 0.85rem;
    }

    .admin-panel--stack {
        display: flex;
        flex-direction: column;
        gap: 0.85rem;
    }

    .admin-card {
        border: var(--admin-border);
        border-radius: var(--admin-radius);
        background: color-mix(in srgb, var(--color-card) 92%, transparent);
        padding: var(--admin-card-padding);
        display: flex;
        flex-direction: column;
        gap: 0.85rem;
    }

    .admin-card__header,
    .admin-card__footer {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 0.75rem;
        flex-wrap: wrap;
    }

    .admin-card__header--stacked {
        align-items: stretch;
        flex-direction: column;
    }

    @media (min-width: 768px) {
        .admin-card__header--stacked {
            flex-direction: column;
            gap: 0.9rem;
        }
    }

    .admin-card__footer {
        padding-top: 0.45rem;
        border-top: 1px dashed
            color-mix(in srgb, var(--color-foreground) 15%, transparent);
    }

    .admin-card__header h2 {
        font-size: var(--admin-font-base);
        margin: 0.1rem 0 0;
        line-height: 1.3;
    }

    .admin-eyebrow {
        font-size: var(--admin-font-xs);
        text-transform: uppercase;
        letter-spacing: 0.16em;
        color: color-mix(in srgb, var(--color-foreground) 55%, transparent);
        margin: 0;
    }

    .admin-stat-card {
        border: var(--admin-dashed-border);
        border-radius: var(--admin-radius);
        padding: 0.75rem 0.85rem;
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 0.65rem;
        align-items: center;
        background: color-mix(
            in srgb,
            var(--color-background) 93%,
            transparent
        );
        transition: transform 150ms ease;
    }

    .admin-stat-card:hover {
        transform: translateY(-1px);
    }

    .admin-stat-card__icon {
        width: 2.15rem;
        height: 2.15rem;
        border-radius: 0.6rem;
        display: grid;
        place-items: center;
        background: color-mix(in srgb, var(--color-primary) 18%, transparent);
        color: var(--color-primary);
        font-size: 0.95rem;
    }

    .admin-stat-card__label {
        font-size: var(--admin-font-xs);
        letter-spacing: 0.12em;
        text-transform: uppercase;
        color: color-mix(in srgb, var(--color-foreground) 65%, transparent);
        margin: 0;
    }

    .admin-stat-card__value {
        font-size: clamp(1rem, 2vw, 1.35rem);
        font-weight: 700;
        margin: 0.1rem 0;
        font-family: var(--font-display);
        line-height: 1.15;
    }

    .admin-stat-card__meta {
        font-size: var(--admin-font-xs);
        color: color-mix(in srgb, var(--color-foreground) 65%, transparent);
        margin: 0.1rem 0 0;
    }

    .admin-list {
        display: flex;
        flex-direction: column;
        gap: 0.65rem;
    }

    .admin-list__item {
        display: flex;
        flex-direction: column;
        gap: 0.45rem;
        border: var(--admin-border);
        border-radius: var(--admin-radius);
        padding: 0.75rem;
        transition: border-color 150ms ease;
    }

    .admin-list__item:hover {
        border-color: color-mix(
            in srgb,
            var(--color-foreground) 20%,
            transparent
        );
    }

    @media (min-width: 640px) {
        .admin-list__item {
            flex-direction: row;
            justify-content: space-between;
            align-items: center;
        }
    }

    .admin-list__title {
        font-weight: 600;
        font-size: var(--admin-font-base);
        margin-bottom: 0.1rem;
    }

    .admin-list__meta {
        font-size: var(--admin-font-sm);
        color: color-mix(in srgb, var(--color-foreground) 65%, transparent);
        margin: 0;
    }

    .admin-notifications__summary {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 0.65rem;
        width: 100%;
    }

    .admin-notifications__controls {
        margin-top: 0.75rem;
        display: flex;
        justify-content: space-between;
        gap: 0.75rem;
        align-items: center;
        flex-wrap: wrap;
    }

    .admin-checkbox {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 700;
        color: color-mix(in srgb, var(--color-foreground) 75%, transparent);
        font-size: var(--admin-font-sm);
    }

    .admin-checkbox input[type="checkbox"] {
        width: 1.05rem;
        height: 1.05rem;
        accent-color: var(--color-primary);
        border-radius: 0.35rem;
    }

    .admin-notifications__control-actions {
        display: flex;
        gap: 0.4rem;
        flex-wrap: wrap;
    }

    .admin-notifications__pill {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 0.65rem;
        align-items: center;
        padding: 0.65rem 0.75rem;
        border-radius: calc(var(--admin-radius) - 0.35rem);
        border: var(--admin-border);
        background: color-mix(in srgb, var(--color-background) 96%, transparent);
    }

    .admin-notifications__pill--accent {
        border-color: color-mix(in srgb, var(--color-primary) 30%, transparent);
        background: color-mix(
            in srgb,
            var(--color-primary) 8%,
            color-mix(in srgb, var(--color-card) 92%, transparent)
        );
    }

    .admin-notifications__pill-icon {
        width: 2.4rem;
        height: 2.4rem;
        border-radius: 0.85rem;
        display: grid;
        place-items: center;
        background: color-mix(in srgb, var(--color-foreground) 12%, transparent);
        color: color-mix(in srgb, var(--color-foreground) 80%, transparent);
    }

    .admin-notifications__pill-icon--success {
        background: color-mix(in srgb, var(--color-success, #3fcf8e) 18%, transparent);
        color: color-mix(in srgb, var(--color-success, #3fcf8e) 85%, transparent);
    }

    .admin-notifications__pill-body {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
    }

    .admin-notifications__pill-label {
        margin: 0;
        font-size: var(--admin-font-xs);
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
    }

    .admin-notifications__pill-value {
        margin: 0;
        font-weight: 700;
        font-size: var(--admin-font-base);
    }

    .admin-notifications__pill-icon--warning {
        background: color-mix(in srgb, #f6a609 20%, transparent);
        color: color-mix(in srgb, #f6a609 90%, transparent);
    }

    .admin-notifications__controls {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .admin-notifications__toolbar {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
        justify-content: space-between;
    }

    .admin-notifications__search {
        flex: 1;
        min-width: 220px;
        display: grid;
        grid-template-columns: auto 1fr;
        align-items: center;
        gap: 0.4rem;
        padding: 0.6rem 0.75rem;
        border-radius: calc(var(--admin-radius) - 0.35rem);
        border: var(--admin-border);
        background: color-mix(in srgb, var(--color-background) 96%, transparent);
    }

    .admin-notifications__search input {
        border: none;
        background: transparent;
        font-size: var(--admin-font-sm);
        outline: none;
        color: inherit;
    }

    .admin-notifications__control-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
        justify-content: flex-end;
    }

    .admin-notifications__control-actions--simple {
        justify-content: flex-start;
    }

    .admin-filter-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 0.65rem;
        align-items: start;
    }

    .admin-filter {
        border: var(--admin-border);
        border-radius: calc(var(--admin-radius) - 0.45rem);
        padding: 0.6rem 0.75rem;
        background: color-mix(in srgb, var(--color-card) 90%, transparent);
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
    }

    .admin-filter__label {
        margin: 0;
        font-size: var(--admin-font-xs);
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
    }

    .admin-filter__chips {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
    }

    .admin-filter-chip {
        border: 1px dashed color-mix(in srgb, var(--color-foreground) 25%, transparent);
        border-radius: 999px;
        padding: 0.35rem 0.75rem;
        background: color-mix(in srgb, var(--color-background) 92%, transparent);
        font-size: var(--admin-font-sm);
        cursor: pointer;
        transition: all 150ms ease;
    }

    .admin-filter-chip:hover,
    .admin-filter-chip:focus-visible {
        transform: translateY(-1px);
        outline: none;
        border-color: color-mix(in srgb, var(--color-primary) 40%, transparent);
        box-shadow: 0 8px 18px -12px color-mix(in srgb, var(--color-primary) 30%, transparent);
    }

    .admin-filter-chip.is-active {
        background: color-mix(in srgb, var(--color-primary) 14%, transparent);
        color: var(--color-primary);
        border-color: color-mix(in srgb, var(--color-primary) 35%, transparent);
    }

    .admin-filter__toggles {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
    }

    .admin-toggle {
        display: grid;
        grid-template-columns: auto 1fr;
        align-items: center;
        gap: 0.45rem;
    }

    .admin-toggle input {
        accent-color: var(--color-primary);
    }

    .admin-toggle__label {
        font-size: var(--admin-font-sm);
        color: color-mix(in srgb, var(--color-foreground) 80%, transparent);
    }

    .admin-notifications__meta {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem 0.75rem;
        color: color-mix(in srgb, var(--color-foreground) 70%, transparent);
        font-size: var(--admin-font-sm);
    }

    .admin-notifications__meta-item {
        margin: 0;
        display: inline-flex;
        align-items: center;
        gap: 0.35rem;
    }

    .admin-notifications {
        display: flex;
        flex-direction: column;
        gap: 0.65rem;
    }

    .admin-notification {
        position: relative;
        border: var(--admin-border);
        border-radius: var(--admin-radius);
        background: color-mix(in srgb, var(--color-background) 94%, transparent);
        overflow: hidden;
    }

    .admin-notification__swipe {
        position: relative;
    }

    .admin-notification__main {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 0.75rem;
        align-items: start;
        padding: 0.75rem;
        transition: transform 180ms ease;
        touch-action: pan-y;
    }

    .admin-notification__swipe-actions {
        position: absolute;
        inset: 0;
        width: min(14rem, 58%);
        margin-left: auto;
        display: flex;
        justify-content: flex-end;
        align-items: center;
        gap: 0.4rem;
        padding: 0.5rem 0.6rem;
        background: color-mix(in srgb, var(--color-card, var(--color-background)) 88%, transparent);
    }

    .admin-notification__swipe-button {
        border: none;
        border-radius: 0.75rem;
        padding: 0.65rem 0.9rem;
        font-weight: 700;
        font-size: var(--admin-font-sm);
        color: var(--color-foreground);
        background: color-mix(in srgb, var(--color-primary) 16%, transparent);
        border: 1px solid color-mix(in srgb, var(--color-primary) 30%, transparent);
        cursor: pointer;
        transition: transform 120ms ease, box-shadow 120ms ease, background 120ms ease;
    }

    .admin-notification__swipe-button:hover,
    .admin-notification__swipe-button:focus-visible {
        transform: translateY(-1px);
        box-shadow: 0 10px 24px -16px color-mix(in srgb, var(--color-primary) 40%, transparent);
        outline: none;
    }

    .admin-notification__swipe-button--danger {
        background: color-mix(in srgb, #ff6b6b 16%, transparent);
        border-color: color-mix(in srgb, #ff6b6b 35%, transparent);
        color: color-mix(in srgb, #ff2d55 80%, transparent);
    }

    .admin-notification__icon {
        width: 2.25rem;
        height: 2.25rem;
        border-radius: 0.75rem;
        display: grid;
        place-items: center;
        background: color-mix(in srgb, var(--color-primary) 14%, transparent);
        color: var(--color-primary);
        font-size: 1rem;
    }

    .admin-notification__icon[data-type="message"] {
        background: color-mix(in srgb, var(--color-foreground) 10%, transparent);
        color: color-mix(in srgb, var(--color-foreground) 75%, transparent);
    }

    .admin-notification__icon[data-type="system"] {
        background: color-mix(in srgb, var(--color-warning, #f6c744) 18%, transparent);
        color: color-mix(in srgb, var(--color-warning, #f6c744) 80%, transparent);
    }

    .admin-notification__content {
        display: flex;
        flex-direction: column;
        gap: 0.4rem;
    }

    .admin-notification__top {
        display: flex;
        justify-content: space-between;
        gap: 0.75rem;
        flex-wrap: wrap;
        align-items: flex-start;
    }

    .admin-notification__titles {
        display: flex;
        flex-direction: column;
        gap: 0.2rem;
    }

    .admin-notification__labels {
        display: flex;
        align-items: center;
        gap: 0.35rem;
        flex-wrap: wrap;
        justify-content: flex-end;
    }

    .admin-notification__title {
        font-size: var(--admin-font-base);
        font-weight: 700;
        margin: 0;
    }

    .admin-notification__type {
        font-size: var(--admin-font-xs);
        padding: 0.2rem 0.55rem;
        border-radius: 999px;
        background: color-mix(in srgb, var(--color-foreground) 10%, transparent);
        color: color-mix(in srgb, var(--color-foreground) 80%, transparent);
        border: 1px solid
            color-mix(in srgb, var(--color-foreground) 15%, transparent);
    }

    .admin-notification__type[data-type="comment"] {
        background: color-mix(in srgb, var(--color-primary) 18%, transparent);
        color: var(--color-primary);
        border-color: color-mix(in srgb, var(--color-primary) 35%, transparent);
    }

    .admin-notification__type[data-type="like"] {
        background: color-mix(in srgb, #ff6b9a 15%, transparent);
        color: color-mix(in srgb, #ff6b9a 80%, transparent);
        border-color: color-mix(in srgb, #ff6b9a 30%, transparent);
    }

    .admin-notification__type[data-type="message"] {
        background: color-mix(in srgb, var(--color-foreground) 12%, transparent);
        color: color-mix(in srgb, var(--color-foreground) 75%, transparent);
    }

    .admin-notification__priority {
        font-size: var(--admin-font-xs);
        padding: 0.2rem 0.55rem;
        border-radius: 999px;
        border: 1px dashed color-mix(in srgb, var(--color-foreground) 24%, transparent);
        background: color-mix(in srgb, var(--color-background) 90%, transparent);
    }

    .admin-notification__priority[data-priority="high"] {
        background: color-mix(in srgb, #ff6b6b 18%, transparent);
        color: color-mix(in srgb, #ff6b6b 92%, transparent);
        border-color: color-mix(in srgb, #ff6b6b 35%, transparent);
    }

    .admin-notification__priority[data-priority="low"] {
        background: color-mix(in srgb, var(--color-foreground) 8%, transparent);
        color: color-mix(in srgb, var(--color-foreground) 70%, transparent);
    }

    .admin-notification__category {
        font-size: var(--admin-font-xs);
        padding: 0.2rem 0.6rem;
        border-radius: 999px;
        background: color-mix(in srgb, var(--color-primary) 12%, transparent);
        color: var(--color-primary);
        border: 1px solid color-mix(in srgb, var(--color-primary) 28%, transparent);
    }

    .admin-notification__meta {
        margin: 0;
        font-size: var(--admin-font-xs);
        letter-spacing: 0.08em;
        text-transform: uppercase;
        color: color-mix(in srgb, var(--color-foreground) 55%, transparent);
    }

    .admin-notification__text {
        margin: 0.1rem 0 0;
        font-size: var(--admin-font-sm);
        color: color-mix(in srgb, var(--color-foreground) 70%, transparent);
        line-height: 1.5;
    }

    .admin-notification__tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.3rem;
        margin-top: 0.35rem;
    }

    .admin-notification__tag {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        padding: 0.2rem 0.5rem;
        border-radius: 999px;
        background: color-mix(in srgb, var(--color-foreground) 8%, transparent);
        color: color-mix(in srgb, var(--color-foreground) 75%, transparent);
        font-size: var(--admin-font-xs);
    }

    .admin-notification__footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 0.65rem;
        flex-wrap: wrap;
        padding-top: 0.25rem;
    }

    .admin-notification__status {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
    }

    .admin-notification__status-text {
        font-size: var(--admin-font-sm);
        color: color-mix(in srgb, var(--color-foreground) 68%, transparent);
    }

    .admin-notification__actions {
        display: flex;
        gap: 0.45rem;
        align-items: center;
        justify-content: flex-end;
    }

    .admin-notification__meta-bar {
        display: flex;
        gap: 0.75rem;
        align-items: center;
        flex-wrap: wrap;
        margin-top: 0.5rem;
        font-size: var(--admin-font-xs);
        color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
    }

    .admin-notification__meta-bar i {
        color: color-mix(in srgb, var(--color-foreground) 55%, transparent);
        margin-right: 0.2rem;
    }

    .admin-notification[data-status="unread"] {
        border-color: color-mix(in srgb, var(--color-primary) 30%, transparent);
        box-shadow: 0 6px 18px -14px color-mix(
                in srgb,
                var(--color-primary) 35%,
                transparent
            );
        background: color-mix(
            in srgb,
            var(--color-primary) 6%,
            color-mix(in srgb, var(--color-card, var(--color-background)) 94%, transparent)
        );
    }

    .admin-notification[data-priority="high"] {
        border-color: color-mix(in srgb, #ff6b6b 35%, transparent);
    }

    .admin-notification[data-status="read"] .admin-dot {
        background: color-mix(in srgb, var(--color-foreground) 35%, transparent);
        box-shadow: none;
        animation: none;
    }

    .admin-dot {
        width: 0.65rem;
        height: 0.65rem;
        border-radius: 50%;
        background: var(--color-primary);
        display: inline-flex;
        box-shadow: 0 0 0 4px color-mix(
                in srgb,
                var(--color-primary) 20%,
                transparent
            );
        animation: pulse-ring 2.4s ease-in-out infinite;
    }

    .admin-tag {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        background: color-mix(in srgb, var(--color-primary) 12%, transparent);
        color: var(--color-primary);
        border-radius: 999px;
        padding: 0.15rem 0.6rem;
        font-size: var(--admin-font-xs);
        text-transform: uppercase;
        letter-spacing: 0.12em;
    }

    .admin-row-actions {
        display: flex;
        gap: 0.35rem;
        flex-wrap: wrap;
        justify-content: flex-start;
    }

    @media (min-width: 768px) {
        .admin-row-actions {
            justify-content: flex-end;
        }
    }

    .icon-button {
        width: 2.1rem;
        height: 2.1rem;
        border-radius: 0.7rem;
        border: 1px solid
            color-mix(in srgb, var(--color-foreground) 15%, transparent);
        display: grid;
        place-items: center;
        background: transparent;
        font-size: 0.9rem;
        transition:
            background-color 150ms ease,
            border-color 150ms ease,
            transform 120ms ease;
    }

    .icon-button:hover,
    .icon-button:focus-visible {
        border-color: color-mix(in srgb, var(--color-primary) 50%, transparent);
        color: var(--color-primary);
        transform: translateY(-1px);
    }

    .icon-button--danger {
        border-color: color-mix(in srgb, crimson 40%, transparent);
        color: color-mix(in srgb, crimson 65%, transparent);
    }

    .icon-button--danger:hover,
    .icon-button--danger:focus-visible {
        background: color-mix(in srgb, crimson 10%, transparent);
    }

    .admin-product-list {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .admin-product {
        display: flex;
        gap: 0.75rem;
        border: var(--admin-border);
        border-radius: var(--admin-radius);
        padding: 0.75rem;
        align-items: center;
    }

    .admin-product__media {
        flex: none;
        width: 52px;
        height: 52px;
        border-radius: 0.7rem;
        border: var(--admin-border);
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background: color-mix(in srgb, var(--color-foreground) 5%, transparent);
    }

    .admin-product__media img {
        width: 100%;
        height: 100%;
        border-radius: inherit;
        object-fit: cover;
    }

    .admin-product__title {
        font-weight: 600;
        margin: 0;
        font-size: var(--admin-font-base);
    }

    .admin-product__meta {
        font-size: var(--admin-font-sm);
        color: color-mix(in srgb, var(--color-foreground) 65%, transparent);
        margin: 0.15rem 0;
    }

    .admin-product__price {
        font-family: var(--font-mono);
        font-size: var(--admin-font-sm);
    }

    .admin-pill-badge {
        font-size: var(--admin-font-xs);
        padding: 0.1rem 0.45rem;
        border-radius: 999px;
        border: 1px solid
            color-mix(in srgb, var(--color-foreground) 15%, transparent);
        margin-left: 0.5rem;
    }

    .admin-pill-badge--new {
        background: color-mix(in srgb, var(--color-primary) 12%, transparent);
        color: var(--color-primary);
        border-color: color-mix(in srgb, var(--color-primary) 50%, transparent);
        animation: pulse-ring 2.2s ease-in-out infinite;
        box-shadow: 0 0 0 0 color-mix(in srgb, var(--color-primary) 16%, transparent);
    }

    .admin-link-button {
        display: inline-flex;
        align-items: center;
        gap: 0.3rem;
        color: var(--color-primary);
        font-family: var(--font-mono);
        font-size: var(--admin-font-sm);
        border: none;
        background: none;
        cursor: pointer;
    }

    .admin-empty,
    .admin-empty-state {
        font-size: var(--admin-font-base);
        color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
        margin: 0.25rem 0;
    }

    .admin-empty-state--inline {
        border: var(--admin-dashed-border);
        padding: 0.85rem;
        border-radius: var(--admin-radius);
        background: color-mix(in srgb, var(--color-background) 96%, transparent);
    }

    .admin-empty-state__hint {
        margin: 0.1rem 0 0;
        font-size: var(--admin-font-sm);
        color: color-mix(in srgb, var(--color-foreground) 55%, transparent);
    }

    .admin-records {
        display: flex;
        flex-direction: column;
        gap: 0.55rem;
    }

    .admin-record {
        display: grid;
        gap: 0.7rem;
        padding: 0.8rem;
        border-radius: var(--admin-radius);
        border: var(--admin-border);
        background: color-mix(
            in srgb,
            var(--color-background) 93%,
            transparent
        );
        transition: border-color 150ms ease;
    }

    .admin-record:hover {
        border-color: color-mix(
            in srgb,
            var(--color-foreground) 20%,
            transparent
        );
    }

    @media (min-width: 768px) {
        .admin-record {
            grid-template-columns: minmax(0, 2fr) minmax(0, 2fr) auto;
            align-items: center;
        }
    }

    .admin-record__main {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
    }

    .admin-record__title {
        font-weight: 600;
        margin: 0;
        font-size: var(--admin-font-base);
    }

    .admin-record__slug {
        font-size: var(--admin-font-xs);
        color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
        font-family: var(--font-mono);
    }

    .admin-record__meta {
        display: grid;
        gap: 0.55rem;
        grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
        font-size: var(--admin-font-sm);
    }

    .admin-record__meta dt {
        font-size: var(--admin-font-xs);
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
        margin-bottom: 0.15rem;
    }

    .admin-record__meta dd {
        margin: 0;
        font-weight: 600;
        font-size: var(--admin-font-base);
    }

    .admin-setting-list {
        display: flex;
        flex-direction: column;
        gap: 0.6rem;
    }

    .admin-setting-action {
        border: var(--admin-border);
        border-radius: var(--admin-radius);
        padding: 0.85rem 1rem;
        display: flex;
        justify-content: space-between;
        gap: 0.75rem;
        align-items: center;
        text-decoration: none;
        color: inherit;
        background: transparent;
        transition:
            border-color 150ms ease,
            transform 150ms ease;
    }

    .admin-setting-action span {
        font-size: var(--admin-font-sm);
        color: color-mix(in srgb, var(--color-foreground) 65%, transparent);
    }

    .admin-setting-action--button {
        width: 100%;
        background: none;
        cursor: pointer;
    }

    .admin-setting-action:hover,
    .admin-setting-action:focus-visible {
        border-color: color-mix(in srgb, var(--color-primary) 45%, transparent);
        transform: translateY(-1.5px);
    }

    .admin-metrics {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 1rem;
    }

    .admin-metric {
        border: var(--admin-dashed-border);
        border-radius: var(--admin-radius);
        padding: 0.75rem 0.85rem;
    }

    .admin-metric p {
        font-size: var(--admin-font-xs);
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: color-mix(in srgb, var(--color-foreground) 60%, transparent);
        margin-bottom: 0.25rem;
    }

    .admin-metric strong {
        font-size: clamp(1.05rem, 1.9vw, 1.25rem);
        font-family: var(--font-display);
    }

    .admin-progress {
        display: flex;
        flex-direction: column;
        gap: 1rem;
    }

    .admin-progress__label {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        font-size: var(--admin-font-base);
    }

    .admin-progress__label strong {
        font-family: var(--font-display);
        font-size: clamp(0.95rem, 1.6vw, 1.15rem);
    }

    .admin-progress__track {
        width: 100%;
        height: 0.5rem;
        border-radius: 999px;
        background: color-mix(
            in srgb,
            var(--color-foreground) 10%,
            transparent
        );
        overflow: hidden;
        margin: 0.4rem 0;
    }

    .admin-progress__value {
        display: block;
        height: 100%;
        border-radius: inherit;
        background: linear-gradient(
            90deg,
            var(--color-primary),
            color-mix(
                in srgb,
                var(--color-primary) 80%,
                var(--color-foreground)
            )
        );
    }

    .admin-progress__meta {
        font-size: var(--admin-font-sm);
        color: color-mix(in srgb, var(--color-foreground) 65%, transparent);
    }

    .admin-product__media--compact {
        width: 44px;
        height: 44px;
        border-radius: 0.6rem;
    }

    .admin-product__media--compact img {
        width: 100%;
        height: 100%;
    }

    .admin-row-actions .icon-button {
        flex: none;
    }

    @keyframes bell-ring {
        0% {
            rotate: 0deg;
        }
        15% {
            rotate: 12deg;
        }
        30% {
            rotate: -12deg;
        }
        45% {
            rotate: 8deg;
        }
        60% {
            rotate: -8deg;
        }
        100% {
            rotate: 0deg;
        }
    }

    @keyframes pulse-ring {
        0% {
            box-shadow: 0 0 0 0 color-mix(
                    in srgb,
                    var(--color-primary) 35%,
                    transparent
                );
        }
        70% {
            box-shadow: 0 0 0 14px color-mix(
                    in srgb,
                    var(--color-primary) 0%,
                    transparent
                );
        }
        100% {
            box-shadow: 0 0 0 0 color-mix(
                    in srgb,
                    var(--color-primary) 0%,
                    transparent
                );
        }
    }
</style>
