---
import type { AffiliateProduct } from "../../lib/products";
import Anchor from "../common/Anchor.astro";

interface Props {
  products: AffiliateProduct[];
}

const { products = [] } = Astro.props;

const normalized = products.slice(0, 4);
---

<div class="flex justify-between items-center w-full">
  <h3 class="font-display text-lg sm:text-xl leading-loose">Rekomendasi</h3>
  <Anchor url="/rekomendasi" class="text-base">View All</Anchor>
</div>

<ul class="my-8">
  {
    normalized.map((product) => (
      <li>
        <a
          href={`/rekomendasi#${product.slug}`}
          class="rekomendasi-card block p-4 border border-slate-200 dark:border-slate-700 rounded-lg hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors"
          aria-label={`Lihat ${product.title}`}
        >
          <div class="flex items-start justify-between gap-3">
            <div class="flex-1">
              <div class="text-sm text-blue-600 dark:text-blue-400 uppercase tracking-wider mb-1">
                {product.category}
              </div>
              <h4 class="font-semibold text-slate-900 dark:text-slate-100 text-base mb-2">
                {product.title}
              </h4>
              {product.highlight && (
                <p class="text-sm text-slate-600 dark:text-slate-400 mb-3">
                  {product.highlight}
                </p>
              )}
              <div class="flex items-center gap-2 text-xs text-slate-500 dark:text-slate-400">
                <span>{product.links.length} tautan dukung</span>
                {product.tags?.slice(0, 2).map((tag) => (
                  <span class="px-2 py-1 bg-slate-100 dark:bg-slate-700 rounded-full">
                    {tag}
                  </span>
                ))}
              </div>
            </div>
          </div>
        </a>
      </li>
    ))
  }
</ul>

<style>
  .rekomendasi-card {
    min-height: 120px;
  }

  @media (max-width: 768px) {
    ul {
      display: flex;
      gap: 1rem;
      overflow-x: auto;
      scroll-snap-type: x mandatory;
      padding-bottom: 0.5rem;
      margin-right: -1rem;
      padding-right: 1rem;
    }

    li {
      min-width: 82%;
      scroll-snap-align: start;
      list-style: none;
    }

    .rekomendasi-card {
      min-width: 100%;
    }
  }
</style>
