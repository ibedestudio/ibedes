---
// Toast notification component for user feedback
export interface Props {
    position?:
        | "top-right"
        | "top-left"
        | "bottom-right"
        | "bottom-left"
        | "top-center"
        | "bottom-center";
}

const { position = "bottom-right" } = Astro.props;

const positionClasses = {
    "top-right": "top-4 right-4",
    "top-left": "top-4 left-4",
    "bottom-right": "bottom-4 right-4",
    "bottom-left": "bottom-4 left-4",
    "top-center": "top-4 left-1/2 -translate-x-1/2",
    "bottom-center": "bottom-4 left-1/2 -translate-x-1/2",
};
---

<div
    id="toast-container"
    class:list={[
        "fixed z-50 flex flex-col gap-2 pointer-events-none",
        positionClasses[position],
    ]}
    role="region"
    aria-live="polite"
    aria-label="Notifications"
>
    <!-- Toasts will be dynamically inserted here -->
</div>

<style is:global>
    .toast {
        pointer-events: auto;
        min-width: 280px;
        max-width: 420px;
        padding: 1rem 1.25rem;
        border-radius: 0.75rem;
        border: 2px solid;
        backdrop-filter: blur(8px);
        box-shadow:
            0 4px 6px -1px rgb(0 0 0 / 0.1),
            0 2px 4px -2px rgb(0 0 0 / 0.1);
        animation: toast-slide-in 0.3s ease-out;
    }

    .toast.removing {
        animation: toast-slide-out 0.3s ease-in forwards;
    }

    .toast-success {
        background-color: rgba(16, 185, 129, 0.1);
        border-color: rgb(16, 185, 129);
        color: rgb(5, 150, 105);
    }

    :global(.dark) .toast-success {
        background-color: rgba(16, 185, 129, 0.15);
        color: rgb(52, 211, 153);
    }

    .toast-error {
        background-color: rgba(239, 68, 68, 0.1);
        border-color: rgb(239, 68, 68);
        color: rgb(220, 38, 38);
    }

    :global(.dark) .toast-error {
        background-color: rgba(239, 68, 68, 0.15);
        color: rgb(252, 165, 165);
    }

    .toast-info {
        background-color: rgba(59, 130, 246, 0.1);
        border-color: rgb(59, 130, 246);
        color: rgb(37, 99, 235);
    }

    :global(.dark) .toast-info {
        background-color: rgba(59, 130, 246, 0.15);
        color: rgb(147, 197, 253);
    }

    .toast-warning {
        background-color: rgba(245, 158, 11, 0.1);
        border-color: rgb(245, 158, 11);
        color: rgb(217, 119, 6);
    }

    :global(.dark) .toast-warning {
        background-color: rgba(245, 158, 11, 0.15);
        color: rgb(252, 211, 77);
    }

    @keyframes toast-slide-in {
        from {
            transform: translateX(100%);
            opacity: 0;
        }
        to {
            transform: translateX(0);
            opacity: 1;
        }
    }

    @keyframes toast-slide-out {
        from {
            transform: translateX(0);
            opacity: 1;
        }
        to {
            transform: translateX(100%);
            opacity: 0;
        }
    }
</style>

<script>
    // Toast utility functions
    type ToastType = "success" | "error" | "info" | "warning";

    interface ToastOptions {
        type?: ToastType;
        duration?: number;
        icon?: string;
    }

    const icons = {
        success: "fa-solid fa-circle-check",
        error: "fa-solid fa-circle-xmark",
        info: "fa-solid fa-circle-info",
        warning: "fa-solid fa-triangle-exclamation",
    };

    function showToast(message: string, options: ToastOptions = {}) {
        const { type = "info", duration = 3000, icon } = options;
        const container = document.getElementById("toast-container");
        if (!container) return;

        const toast = document.createElement("div");
        toast.className = `toast toast-${type}`;
        toast.setAttribute("role", "alert");

        const iconClass = icon || icons[type];
        toast.innerHTML = `
      <div class="flex items-center gap-3">
        <i class="${iconClass} text-xl flex-shrink-0"></i>
        <p class="text-sm font-medium">${message}</p>
        <button 
          class="ml-auto flex-shrink-0 opacity-70 hover:opacity-100 transition-opacity"
          aria-label="Close notification"
        >
          <i class="fa-solid fa-xmark text-lg"></i>
        </button>
      </div>
    `;

        const closeBtn = toast.querySelector("button");
        closeBtn?.addEventListener("click", () => removeToast(toast));

        container.appendChild(toast);

        if (duration > 0) {
            setTimeout(() => removeToast(toast), duration);
        }
    }

    function removeToast(toast: HTMLElement) {
        toast.classList.add("removing");
        setTimeout(() => toast.remove(), 300);
    }

    // Make toast function globally available
    if (typeof window !== "undefined") {
        (window as any).showToast = showToast;
    }
</script>
